<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
 
  <meta http-equiv="content-type" content="text/html;charset=UTF-8">
  <meta name="author" content="CSA"><title>コンピュータ将棋選手権出場クライアントに対応していただくこと V1.1.4</title></head><body bgcolor="#ffffff">
 <h1>世界コンピュータ将棋選手権出場クライアントに対応していただくこと</h1>
   <address>
   2009年12月29日<br>
   CSA選手権LAN化計画担当</address>
   <h1>目次</h1>
   <ol>
   <li><a href="#preface">世界コンピュータ将棋選手権のLAN対応について</a></li>
   <li><a href="#game_protocol">対局プロトコル</a><ol>
    <li><a href="#server_role">サーバの役割</a></li>
    <li><a href="#client_mandatory">クライアントの必須要件</a></li>
    <li><a href="#client_options">クライアントにとって必須でない要件</a></li>
   </ol></li>
   <li><a href="#lan_setup">ネットワーク設定とケーブル</a><ol>
    <li><a href="#ip_setup">IP設定</a></li>
    <li><a href="#cable_setup">Ethernetケーブル</a></li>
   </ol></li>
   <li><a href="#lan_notice">LAN運用上の注意事項</a></li>
   <li><a href="#lan_quality">LANの通信品質</a></li>
   <li><a href="#inet_test">インターネットを利用した事前テストの実施について</a></li>
   <li><a href="#local_test">お手元の環境での事前テストについて</a></li>
   <li><a href="#fin">さいごに</a></li>
   <li><a href="#history">本文書の改訂履歴</a></li>
   </ol>

   <strong>
   ※本文書は、<a href="http://www.computer-shogi.org/protocol/tcp_ip_server_113.html">CSAサーバ プロトコル ver.1.1.3</a>の内容を前提としています。
また、選手権でのLAN対応に不可欠な部分の確認については、サーバプロトコルのほか、<a href="#lan_setup">ネットワーク設定とケーブル</a>の項をお読みください。
加えて、トラブルを避けるため、<a href="#lan_notice">LAN運用上の注意事項</a>を遵守してください。
   </strong>

   <a name="preface"><h1>
   1. 世界コンピュータ将棋選手権のLAN対応について
   </h1></a>
   <p>
     　世界コンピュータ将棋選手権（以下、選手権）は、2006年5月に開催された第16回選手権より、段階的にEthernetによるローカルエリアネットワーク
(LAN)を経由した対局に移行しています。
第16回は、主催者側の不手際によるトラブルもありましたが、多くの参加者の皆様に助けられ、なんとか全対局を行うことができました。
同時に、<a href="http://live.computer-shogi.org/wcsc16/">インターネットを通じたライブ中継</a>も初めて行うことができ、広くコンピュータ将棋の魅力・意義・興奮を伝えることができたという点で、記念すべき選手権となりました。
   </p>
   <p>
     　主催者としては、この成果を移行計画の第一段階の成功と考えています。
このことを踏まえ、第17回選手権の参加者の皆さんには、LANによる対局を必須の機能として対応していただくこととなりました（RS-232C対応はトラブル対応のための推奨機能）。
LAN対局では、従来のように対局するコンピュータ同士をRS-232Cケーブルで直結して通信を行う方法とは異なり、選手権に参加するすべてのコンピュータは、Ethernetケーブルとスイッチングハブを用いて選手権の主催者側が用意する審判サーバ機器に接続していただきます。
これによって対局を行うコンピュータがクライアントとなるクライアント/サーバシステムを対局前に構築し、サーバ機器を経由した通信によってすべての対局を行います。
以下、参加するコンピュータをクライアント、審判サーバ機器をサーバと呼称いたします。
   </p>
   <p>
   　このたびのLAN対局への移行は、従来のRS-232C対局における下記の課題の解決を直接の目的としています。
   </p>
   <ul>
   <li>
   <h4>RS-232Cによる物理的な制約の解消</h4>
   <p>
   　RS-232Cによって通信可能な距離はきわめて短く、従来は手作業による指し手入力による対局と同様、対戦するコンピュータ同士を互いに隣接させて配置しなければなりませんでした。
このため、対局ごとに機器を移動しなければなりませんでした。
これは特に大型機器を持ち込む参加者にとって大きな作業負担になっています。
   </p>
   <p>
   　この負担を解消するためLANを導入し、本来のネットワークが持つ、位置の制約からの自由を達成させます。
これにより、ベストの機器の導入を躊躇させる要素をも排除します。
   </p>
   </li>
   <li>
   <h4>普及型ネットワーク機材およびプロトコルの導入</h4>
   <p>
   　近年、RS-232Cは、一部用途を除いて他の通信規格による置き換えが進んでおり、年を追うごとにRS-232Cに対応した機器が減少しています。
RS-232Cコネクタを有するコンピュータの入手が困難となって久しく、このため多くの参加者は、USBケーブルとRS-232Cの変換器を導入するなど対策に追われていました。
   </p>
   <p>
   　これを、入手および導入が容易なネットワーク規格に置き換え、選手権の参加者が思考アルゴリズムの強化に専念できるようにします。
プロトコルはインターネットに用いられているTCP/IPがベースになっており、これをEthernetによって実現します。
現代はインターネットが広く普及しているうえ、有線の室内ネットワークのほとんどがEthernetを用いています。
TCP/IPとEthernetは、大多数のオペレーティングシステム(OS)にてサポートされており、大半の参加者にとって容易に利用可能です。
通信対局にこれらを採用することによって、機材の入手はきわめて容易になるうえ、通信部分のプログラミングも普及型の技術を用いて容易に行えるようになります。
   </p>
   </li>
   <li>
   <h4>通信対局のモニタリングの実現</h4>
   <p>
   　通信による対局では、時おり何らかのトラブルによって対局継続が不可能になることがあります。
このとき従来のRS-232Cによる対局では、トラブルの原因や、相対するコンピュータのどちらに非があるかを客観的に知る方法がありませんでした。
このため、妥当な対策をとることが困難なだけでなく、対局の公正な判定や勝敗の決定が行える保証もありませんでした。
   </p>
   <p>
   　LAN対局では、クライアントのすべての通信をサーバとの間で行い、サーバの仲介によって対局を実現することにより、サーバがクライアントからの通信をすべて把握し、トラブルの原因を監視します。
   </p>
   </li>
   <li>
   <h4>公正な消費時間の計測</h4>
   <p>
   　従来は、コンピュータの消費時間をコンピュータ自身が計測していましたが、この計測が正確に行われていることを保証するのはきわめて困難でした。
これは不正の可能性ばかりでなく、機器の相違による計測差や、プログラミングのミスによっても不公正な状況をもたらす恐れがありました。
近年では、相手の手番のときに考える予測読みの処理も誤計測の原因となる恐れがありました。
   </p>
   <p>
   　LAN対局では、計測をサーバが集中的に行うことにより、公正さを保証します。
   </p>
   </li>
   <li>
   <h4>参加者の作業負担の軽減</h4>
   <p>
   　機器の持ち運び負担が軽減されるほか、通信の妥当性や計測の妥当性をサーバが保証することによって、参加者のデバッグの負担を軽減します。
また、棋譜の確認をサーバが行えるため、棋譜の確認および提出は、クライアントにとっては将来は必須ではなくなります。
加えて、プロトコルの検証作業の多くを、CSAが用意しているテスト用サーバによって行うことが可能です。
   </p>
   </li></ul>
   <p>
   　以上のメリットに加え、対局の観戦が容易になるという副次的な効果があります。
今回の選手権から、すべての対局が、サーバの仲介によって会場のプロジェクタに映し出され、同時に観戦できるようになります。
また今回は、世界中のインターネットユーザが全対局をリアルタイムに観戦できるようになり、コンピュータ将棋がますます注目される存在になるでしょう。
   </p>
   <p>
   　したがいまして、これまでRS-232Cのみに対応されていた方には、新たなプロトコルへの対応作業が必要になることをご了承願います。
本文書は、選手権でのLAN対局のルールの説明に加え、参加者の皆さんによるLAN対応をできる限り容易にすることを目的として作成されています。
   </p>

   <a name="game_protocol"><h1>
   2. 対局プロトコル
   </h1></a>

   <p>
   　LAN対局は、<a href="http://www.computer-shogi.org/protocol/tcp_ip_server_113.html">CSAサーバプロトコル ver.1.1.3</a>に従って行われます。
本節では、このプロトコルにおいて、選手権に関して特記すべき部分について述べます。
   </p>
   <a name="server_role"><h2>
   2.1. サーバの役割
   </h2></a>
   <p>
   　前節にて述べたとおり、サーバはプロトコルにしたがい、通信の妥当性の検証と消費時間の計測を担当します。
妥当でない通信を検知し、排除することによって、LANを正常に保つ役割も負います。
従来と異なり、サーバが計測した消費時間が常に正規の消費時間となります。
指し手ごとの消費時間は、プロトコルにしたがって1手ごとの指し手に付加され、対局する双方のクライアントに送信されます。
   </p>
   <a name="client_mandatory"><h2>
   2.2. クライアントの必須要件
   </h2></a>
   <p>
   　LAN対局において、クライアントは、プロトコルに規定された動作のうち、最低限、下記が可能なように実装されていなければなりません。
   </p><ul>
   <li>ログイン</li>
   <li>対局通知メッセージに対する応答</li>
   <li>対局中の指し手の送受信</li>
   <li>ログアウト</li>
   </ul>
   <p></p>
   <p>
   　ログインに必要なログイン名とパスワードは、選手権参加手続きの過程において、以下の形式にて申請されたものを用います。

   </p><ul>
   <li>試合用:
   <ul>
   <li>ログイン名:</li>
   <li>パスワード</li>
   </ul></li>
   <li>テスト用:
   <ul>
   <li>ログイン名:</li>
   <li>パスワード</li>
   </ul></li>
   </ul>

テスト用のログイン名は、必ず試合用ログイン名と異なる文字列をお選びください。
正規の対局では、必ず試合用のログイン名とパスワードを使用してください。
また、テストのため対局前もしくは対局の合間にサーバへの接続を行う場合は、必ずテスト用のログイン名とパスワードを使用してください。
チーム単独でテストを行う場合は、試合用ログイン名とテスト用ログイン名を使って対戦を行っていただきます。
以上の目的のため、テスト用ログイン名は試合用ログイン名と区別していただく必要があります。
選手権会場での準備の際、対局とテストを適宜すみやかに行えるよう、両方のログイン名でログインする準備を整えておいてください。
   <p></p>
   <p>
　ログイン後、クライアントは、受け取った対局通知メッセージの終端を検出した後、対局を行うため 'AGREE'
をサーバに回答する必要があります。
対局開始直後、手番を持つクライアント、すなわち 'Your_Turn:' と 'To_Move:'
の内容が同一の対局通知メッセージを受信しているクライアントは最初の手を指さなければならず、もう一方のクライアントは指し手を受信するまで指し手を送
信してはいけません。
対局が開始されてから終了するまで、クライアントは、相手の指し手を解釈し、それに応じて局面を正しい状態で記憶し、それに応じた指し手をサーバに送信し
続ける必要があります。
また、TCP/IPのコネクション切断によってログアウトと同様の手続きを行うことが可能ですが、異常終了と区別できるよう、極力ログアウトコマンドの送
信によってログアウトを行うようにしてください。 </p>
   <p>
   　前節にて述べたとおり、正規の消費時間はすべてサーバが計測したものを採用します。
クライアントは、常にこの時間を基づいて残り時間を計測し、かつ1手ごとの消費時間が多くなりすぎないよう時間を計測しつつ指し手を送信し、時間切れを回避しなければなりません。
   </p>
   <p>
     　対局中は、プロトコルに厳格に従うように開発を行ってください。
クライアントがプロトコルに従わない通信を行った場合は、反則負けとなります。
第16回選手権にて、あるクライアントが、相手玉を詰ました直後に相手の投了を待たずにコネクションを切断したことがありました。
これはプロトコルに反した動作ですので、第17回選手権以降では反則負けとして処理されると考えてください。
   </p>
   <p>
   　なお、何らかのトラブルの発生によってLAN対局が継続不可能になった場合は、審判の判定にしたがって、途中の局面からRS-232Cなどによる対局に移行していただく可能性があります。
このとき、やむなく機器の移動を行っていただく場合があります。ご了承ください。
   </p>
   <a name="client_options"><h2>
   2.3. クライアントにとって必須でない要件
   </h2></a>
   <p>
   　プロトコルでは、対局通知メッセージによって対局条件を提示するための書式が定義されています。
ここで記述される事項は、一部を除いて、あらかじめ選手権のルールによって固定されています。
メッセージの内容のうちの固定された情報に関しては、クライアントがあらかじめその内容に適応していれば、それらを解釈する必要はありません。
具体的には、選手権ではサーバを経由する対局プロトコルを用い、持ち時間は1,500秒すなわち25分を全体の持ち時間とし、1手あたり最低1秒を消費します。
千日手は引き分けとして指し直しを行わず、持将棋における勝利宣言ルールが有効となります
   </p>
   <p>
   　また、対局ごとに変化する情報も、指し手の決定に直接影響しない情報か、または事前に知ることのできる情報のいずれかに限られますので、事前の設定が適切に行われていれば、メッセージの
対局通知を示す、'BEGIN Game_Summary' の行で開始され 'END Game_Summary' の行で終了するメッセージのうち、対局ごとに変化するのは、以下の項目のみです。

</p><ul>
<li>Game_ID:</li>
<li>Name+:</li>
<li>Name-:</li>
<li>Your_Turn:</li>
<li>To_Move:</li>
<li>事前の指し手</li>
</ul>

このうち前3者は、対局の内容とは直接の関係はありません。
'Your_Turn:' は、第16回においては、手番が事前に通知されますので、通知に応じた設定が適切に行われていれば、この項目の内容を解釈する必要はありません。
'To_Move:' および事前の指し手は、中断した対局が再開される場合を除き、前者は常に '+' となり、後者は存在しません。
この内容から、クライアントが中断局面の復元と通算の消費時間の計算を行うことが推奨されますが、その内容を事前に確認のうえ正しく設定された状態で対局再開のためのメッセージを受信できれば、この内容を評価する必要はありません。
   <p></p>

   <a name="lan_setup"><h1>
   3. ネットワーク設定とケーブル
   </h1></a>

   <p>
   　本節では、対局プロトコルを除く部分における各種設定、および必要な準備について述べます。
通信に用いられるTCP/IPにおける、IP(Internet Protocol)に関してのサーバおよびクライアントの設定内容、および参加者の皆さんに準備していただくEthernetケーブルは、下記のとおりとなります。
   </p>
   <a name="ip_setup"><h2>
   3.1. IP設定
   </h2></a>
   <p>
   　LAN対局においては、DNS(Domain Name Service)による名前の設定は行われません。
したがって、クライアントからサーバへの接続は、接続時に直接IPアドレスを用いてサーバを指定してください。
   </p>
   <p>
   　IPはバージョン4が用いられます。
したがって、すべてのIPアドレスは32ビット長で表現されます。
IPアドレスおよびポート番号に関する設定は、以下のとおりです。

</p><ul>
<li>サーバおよびクライアントのサブネットマスク: 255.255.255.0</li>
<li>サーバのIPアドレス: 192.168.C.1 (0&lt;=X&lt;=255)</li>
<li>サーバのポート番号: 4081</li>
<li>クライアントのIPアドレス: 192.168.C.X (2&lt;=X&lt;=251)
</li><li>DNSサーバIPアドレス: なし</li>
<li>デフォルトゲートウェイIPアドレス: なし</li>
</ul>

上記において、Cにはサーバおよびすべてのクライアントに共通の値、Xにはクライアントごとに個別の値が割り当てられます。
サーバおよびクライアントのIPアドレスは、選手権参加申込受付終了後、各参加者に個別に通知いたします。
LAN対局時は、DHCP(Dynamic Host Configuration Protocol)によるIPアドレスの自動割り当ては行われません。
なお、参加者が250を超えた場合、サブネットマスクおよびクライアントのIPアドレスは変更される予定です。
   <p></p>

   <a name="cable_setup"><h2>
   3.2. Ethernetケーブル
   </h2></a>
   <p>
   　選手権に用いられるLANは、カテゴリ3以上の伝送能力を持つEthernetケーブルおよびスイッチングハブを介してサーバとクライアントを接続することによって構築されます。
各参加者は、10BASE-Tや100BASE-TX、もしくはそれ以上の性能を有する、RJ-45コネクタを持つ普及型の3メートル～5メートルのEthernetストレートケーブルを1本持参してください。
それを会場にて指定されたスイッチングハブに接続することによって、クライアントをLANに接続していただきます。
各参加者のコンピュータを接続したスイッチングハブは、さらに上流のスイッチングハブに接続され集約されます。
サーバは上流のスイッチングハブに接続され、各クライアントとの通信を行います。
   </p>

   <a name="lan_notice"><h1>
   4. LAN運用上の注意事項
   </h1></a>

   <p>
   　LAN対局における各種のトラブルを極力減らすため、LANに接続されるクライアントは、下記の注意事項が遵守されるよう実装および設定され、また正しく運用されなければなりません。
   </p>
   <p>
   　クライアントは、最低限の接続確認、サーバへの接続、最低限の指し手の送信、およびそれらのための経路情報の獲得に関する最低限の通信を除いて、不必要な通信および対局に無関係な通信を行ってはいけません。
具体的には、ICMPパケットによるエコー要求および応答、TCPパケットによる対局のための通信、ARP要求および応答を必要に応じて行うほかは、情報を送信してはいけません。
他のクライアントとの通信も行ってはいけません。
これは、LAN上の不必要なパケットを極力排除することによって、LANの混雑やルーティング情報の撹乱を防ぎ、LANの安定運用を確実なものにするためです。
特に、クライアントがコンピュータウィルスやワームに感染していないこと、HTTPサーバやDHCPサーバ、将棋以外のネットワークアプリケーションなどが動作していないことは、事前に充分に確認してください。
   </p>
   <p>
   　上記は、異常な動作をする他のクライアントの影響を受けることなく正常に動作しなければならないことを含みます。
すなわち、他のクライアントからウィルスを感染させられたり、対局と無関係な通信に応答したりしないよう、充分配慮されていなければなりません。
   </p>
   <p>
     　IPアドレスの設定は、正確に行われるよう慎重に確認して行ってください。
LANに接続されるコンピュータのIPアドレスが間違って設定された結果、サーバや他のクライアントと一致してしまうと、対局中に通信が突然途絶えてしまうなどの深刻なトラブルがすべてのクライアントに対して発生する恐れが生じます。
充分ご注意ください。
   </p>
   <p>
   　また、クライアントと、クライアントが接続されるスイッチングハブとの間の接続は確実に行い、通信品質が保たれるようにしてください。
対局中にLANケーブルが抜けることのないよう、持参するLANケーブルのRJ-45コネクタが「カチッ」と音がするまでしっかりとクライアントとハブに挿入し固定させ、対局中に引っ張られても抜けないようにしてください。
また持参するLANケーブルには、「カチッ」と固定されなかったり、引っ張られると抜ける恐れのあるようなコネクタがついたもの、選手権中に断線する恐れのあるような老朽化したものを避けてください。
   </p>

   <a name="lan_quality"><h1>
   5. LANの通信品質
   </h1></a>
   <p>
   　各クライアントが接続されるスイッチングハブとサーバとの間の通信品質、およびサーバの通信品質は、主催者側の責任において、下記のように確保されます。
   </p><ul>
   <li>
   スイッチングハブからサーバまでの間の機器において、突発的な異常が発生しない限り、100ミリ秒以内にすべてのEthernetパケットが通過する。
   </li>
   <li>
   突発的な異常が発生しない限りにおいて、サーバはクライアントからの正常な指し手を受信してから100ミリ秒以内に、それに対するクライアントへの応答を完了する。
   </li>
   </ul>
   <p></p>

   <a name="inet_test"><h1>
   6. インターネットを利用した事前テストの実施について
   </h1></a>
   <p>
   　LAN対局のクライアント実装が正常に動作することを確認するため、CSAでは、インターネットを経由してアクセス可能な対局サーバを準備しています。
テスト用サーバでは、試合用とテスト用の両方のログイン名を使用してログインすることができます。
上記ログイン名は、選手権参加申込受付後、主催者側で速やかにサーバにて有効となるようにいたします。
その後、下記のインターネット対局サーバに接続することによって、テストを行うことができます。
なお、過去にGPW杯、コンピュータ将棋オープン戦、王者戦のいずれかに参加された方は、その際に使われたログイン名も使用することができます。
   </p>
   <ul>
     <li>サーバ名: gserver.computer-shogi.org</li>
     <li>サーバのポート番号: 4081</li>
   </ul>

   <p>
テスト用サーバへの接続は、IPアドレスを用いる選手権でのLAN対局と異なり、DNSを利用してサーバ名でアクセスしていただきます。
また、クライアントのサブネットマスクやIPアドレスなどには、各クライアントの接続環境に応じた設定を用いてください。
   </p>
 <p>
   　テスト用サーバにログインした直後、同様にログイン直後の他のクライアントが存在していない場合は、テスト用サーバは何も送信せず次のクライアントを待ちます。
同様のクライアントが存在する場合、もしくは他のクライアントがログインした場合は、その両者が対局を行うための対局通知メッセージがテスト用サーバからただちに送信されます。
LAN対局と同様、両者が対局通知メッセージに対して 'AGREE' をテスト用サーバに回答することによって対局が開始され、テストを行えます。
試合用とテスト用のログイン名で2つのクライアントをログインさせることにより、単独の参加チームだけでテストを行うことができます。
   </p>
   <p>
   　テスト用サーバは、対局が終了した後、もしくは一度送信された対局通知メッセージがいずれかのクライアントによって拒絶され不成立となった後のクライアントには対局通知メッセージを送信しません。
この状態からテスト対局をを行う場合は、いったんログアウトして再度ログインするか、もしくは下記のメッセージをテスト用サーバに送信することによって、再度対局通知メッセージを受信する必要があります。
<pre>CHALLENGE
</pre>
これはテスト用サーバ接続時にのみ有効なメッセージであり、プロトコルには規定されていません。
また、LAN対局では意味を持ちません。
テスト用サーバは、上記のメッセージを送信したクライアントを、ログイン直後のクライアントと同様、対局通知メッセージを送信する対象のクライアントとみなします。
同様のクライアントが他に存在しない場合、テスト用サーバは、
<pre>CHALLENGE ACCEPTED
</pre>
というメッセージをクライアントに送信し、次のクライアントを待つ状態に入ったことを示します。
同様のクライアントが存在する場合、もしくは他のクライアントが現れた場合は、ログイン直後と同様、ただちに対局通知メッセージが両者に送信されます。
以上の要領により、テストを継続することができます。
</p>
   <p>
   　また、テスト用サーバに限り、中断した対局の再開テストを行えるようになっています。
現在、対局サーバが自動マッチメークした対局では、対局中に指し手として、
<pre>%CHUDAN
</pre>
を送信することによって、先手および後手が各1回だけ対局を中断させることができます。
中断された対局は、
<pre>CHALLENGE
</pre>の送信、または再ログインによって同じ対局者が同時に自動対局待ちの状態になったとき、中断直前の局面にて対局が再開されます。
再開時の局面は、プロトコルにしたがって初手から中断直前の局面までの指し手が対局通知に付加されることによって示されます。
したがって、中断再開機能を指し手つきの対局通知の読み込みテストに使用することができます。
再開後の対局は、中断した側の対局者の再中断が不可能になった点を除き、中断前と同様に進行します。
中断再開は、選手権において万一、トラブルによって対局の中断を余儀なくされた場合に、途中から対局を再開できるようにするための対応のテストとして利用することができます。
なお、選手権での対局ではクライアントからのコマンドによる対局の中断はできませんのでご注意ください。
   </p>

   <a name="local_test"><h1>
   7. お手元の環境での事前テストについて
   </h1></a>
   <p>
   　<a href="#inet_test">インターネットでのテスト</a>が成功しましたら、皆さんのお手元の環境にてサーバ接続テストを実施されることをお薦めいたします。
これは、選手権でのLAN対局のようなネットワーク遅延のきわめて少ない環境でもクライアントが正常に動作するかどうかを検証するのに有効です。
   </p>
   <p>
   　ネットワーク遅延がわずかな場合、クライアントが指し手を送信し、サーバがその指し手に消費時間を付加してクライアントに送信した後、クライアントがその指し手の受信処理を行う前にサーバがその次の相手の指し手を送信することがあります。
この場合、サーバが送信した2つの指し手をクライアントが正常に処理しないと、指し手を正しく読み取れない恐れがあります。
一例として、連結した2つの指し手を1つの指し手とみなしてしまい、相手の次の手を見逃してしまう可能性があります。
これを正しく処理するためには、受信した指し手文字列中のすべてのLF（ラインフィード文字）を検出し、LFごとに区切られた文字列をひとつひとつの指し手とみなすようにしなければなりません。
この処理にバグが含まれていないかどうかを確かめるには、インターネットを介さないテストが有効です。
インターネット環境では、相手の指し手が届くまでの間に遅延が発生するため、それまでに自分の指し手の受信処理が終了する可能性が高く、指し手の区切り処理を検証する機会がきわめて少なくなります。
   </p>
   <p>
   　お手元の環境でのテストには、<a href="http://www.junichi-takada.jp/sficp/">Shogi Framework Implements CSA Protocol</a>に置かれている<a href="http://www.junichi-takada.jp/sficp/sficp_applet.html">対局クライアントJavaアプレット</a>のご利用を推奨いたします。
将棋盤のウィンドウが開いた後、メニューから[サーバ]→[簡易サーバ起動]を選択すると、Javaアプレットを実行したコンピュータで簡易なサーバが起動し、ポート番号4081でクライアントのログインを待ち受けます。
簡易サーバ起動後、2つのクライアントを簡易サーバにログインさせると、ただちに対局条件の送信が行われますので、以下インターネット上のサーバでのテストと同様に対局をお試しください。
ノータイムでの指し手が続いた場合でも受信処理が正しく行われるかどうかをテストされることをお薦めいたします。
なお、WindowsXPなど一部のOSでは、簡易サーバ起動時、セキュリティ警告メッセージが出る可能性があります。
   </p>
   <p>
   　Javaアプレットは、<a href="http://java.com/ja/download/index.jsp">Javaプラグイン</a>がインストールされたコンピュータであればWebブラウザ上で動作させることができます。
簡易サーバの接続先となるIPアドレスは、クライアントソフトを動作させているコンピュータのIPアドレスとなります。
クライアントとサーバを同一のコンピュータで実行させている場合は、IPアドレス '127.0.0.1' またはホスト名 'localhost' を指定することもできます。
なお、簡易サーバはサーバとしてのすべての機能を備えてはいませんので、指し手の検証その他の用途にはCSAのサイトのサーバを利用されることをお薦めいたします。
また対局クライアントJavaアプレットは、簡易サーバとクライアントの機能を同時に利用することができますので、単独でコンピュータとの対戦テストに利用することができます。
   </p>

   <a name="fin"><h1>
   8. さいごに
   </h1></a>
   <p>
   　LAN対局への移行をスムーズに行うためには、参加者の皆さんのご協力が不可欠です。
LAN対局の導入は、初期においては従来になかったトラブルが発生する可能性もありますが、中・長期的には現行のシステムの課題を改善し、より対局に集中できる運営が可能になる、と主催者側では判断しております。
   </p>
   <p>
   　また、LANからインターネットへの対局のリアルタイム中継が可能になることにより、コンピュータ将棋の強さを全世界にアピールすることができ、注目を集めることによって、コンピュータ将棋のさらなる発展が期待されます。
   </p>
   <p>
   　本文書について不明な点がありましたら、<a href="mailto:csa_protocol@computer-shogi.org">csa_protocol@computer-shogi.org</a>までお気軽にお問い合わせください。
   </p>

   <a name="history"><h1>
   9. 本文書の改訂履歴
   </h1></a>

   <ul>
   <li>2006年1月10日 初版</li>
   <ul>
   <li><a href="http://www.computer-shogi.org/protocol/tcp_ip_server_11.html">CSAサーバ プロトコル ver.1.1</a>から、選手権のみに関する部分を抜き出し、第16回選手権におけるLAN対局導入の内容、クライアントの満たすべき要件、設定について、大幅に加筆修正した。
   </li></ul>
   <li>2006年1月19日 V1.1.1</li>
   初版からの変更点<ul>
     <li>リンク先を変更。</li>
   </ul>
   <li>2006年4月19日 V1.1.2</li>
   V1.1.1からの変更点<ul>
   <li><a href="#local_test">7. お手元の環境での事前テストについて</a>を追加。
   </li></ul>
   <li>2006年12月24日 V1.1.3</li>
   V1.1.2からの変更点<ul>
   <li>第16回選手権に関する諸表記を、第17回選手権用に変更。<ul>
	 <li>LAN対局を必須、RS-232C対局を推奨に変更。</li>
	 <li><a href="#preface">1. 世界コンピュータ将棋選手権のLAN対応について</a>を、第16回選手権の結果を踏まえて第17回選手権の説明を行う内容に変更。</li>
   </ul></li>
   <li><a href="#client_mandatory">2.2. クライアントの必須要件</a>において、対局中にクライアントがプロトコルに反した場合に反則負けとなることを明記する表記を追加。
   <li><a href="#lan_notice">4. LAN運用上の注意事項</a>において、LAN設定およびLANケーブルに関するトラブルを予防するための表記を追加。
   </li>
   <li>ほか、細部の表記を変更。
   </li></ul>
   <li>2009年12月29日 V1.1.4</li>
   V1.1.3からの変更点<ul>
   <li><a href="#ip_setup">3.1. IP設定</a>において、IPアドレスの設定を変更。
   <li><a href="#inet_test">6. インターネットを利用した事前テストの実施について</a>において、中断再開テストの説明を追加。
   </ul>
   </ul>

 
</body></html>

