<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>module Bioshogi::ScreenImage - RDoc Documentation</title>

  <meta name="keywords" content="ruby,module,Bioshogi::ScreenImage">

    <meta name="description" content="Documentation for the Bioshogi::ScreenImage module">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
  
  
  
  
  
  <div class="nav-section">
    <h3>Class Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-c-new">new</a></li>
      <li ><a href="#method-c-renderer">renderer</a></li>
    </ul>
  </div>



  <div class="nav-section">
    <h3>Instance Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-i-board_layer_create">board_layer_create</a></li>
      <li ><a href="#method-i-canvas_layer_create">canvas_layer_create</a></li>
      <li ><a href="#method-i-cell_draw">cell_draw</a></li>
      <li ><a href="#method-i-cell_h">cell_h</a></li>
      <li ><a href="#method-i-cell_rect">cell_rect</a></li>
      <li ><a href="#method-i-cell_vmin">cell_vmin</a></li>
      <li ><a href="#method-i-cell_w">cell_w</a></li>
      <li ><a href="#method-i-cell_walker">cell_walker</a></li>
      <li ><a href="#method-i-center">center</a></li>
      <li ><a href="#method-i-char_draw">char_draw</a></li>
      <li ><a href="#method-i-clear_all">clear_all</a></li>
      <li ><a href="#method-i-condition_then_color_negate">condition_then_color_negate</a></li>
      <li ><a href="#method-i-condition_then_flip">condition_then_flip</a></li>
      <li ><a href="#method-i-current_place">current_place</a></li>
      <li ><a href="#method-i-d">d</a></li>
      <li class="calls-super" ><a href="#method-i-default_params">default_params</a></li>
      <li ><a href="#method-i-display">display</a></li>
      <li ><a href="#method-i-draw_context">draw_context</a></li>
      <li ><a href="#method-i-dynamic_layer_setup">dynamic_layer_setup</a></li>
      <li ><a href="#method-i-ext_name">ext_name</a></li>
      <li ><a href="#method-i-face_pentagon_color">face_pentagon_color</a></li>
      <li ><a href="#method-i-face_pentagon_draw">face_pentagon_draw</a></li>
      <li ><a href="#method-i-face_pentagon_scale">face_pentagon_scale</a></li>
      <li ><a href="#method-i-face_pentagon_stroke_width">face_pentagon_stroke_width</a></li>
      <li ><a href="#method-i-image_basename">image_basename</a></li>
      <li ><a href="#method-i-image_format">image_format</a></li>
      <li ><a href="#method-i-image_rect">image_rect</a></li>
      <li ><a href="#method-i-inner_frame_draw">inner_frame_draw</a></li>
      <li ><a href="#method-i-inner_frame_lattice_color">inner_frame_lattice_color</a></li>
      <li ><a href="#method-i-inner_frame_stroke_color">inner_frame_stroke_color</a></li>
      <li ><a href="#method-i-inner_frame_stroke_width">inner_frame_stroke_width</a></li>
      <li ><a href="#method-i-lattice">lattice</a></li>
      <li ><a href="#method-i-lattice_draw">lattice_draw</a></li>
      <li ><a href="#method-i-lattice_layer_create">lattice_layer_create</a></li>
      <li ><a href="#method-i-lattice_stroke_width">lattice_stroke_width</a></li>
      <li ><a href="#method-i-line_draw">line_draw</a></li>
      <li ><a href="#method-i-minus_one">minus_one</a></li>
      <li ><a href="#method-i-next_build">next_build</a></li>
      <li ><a href="#method-i-o">o</a></li>
      <li ><a href="#method-i-origin_place">origin_place</a></li>
      <li ><a href="#method-i-outer_bottom_right">outer_bottom_right</a></li>
      <li ><a href="#method-i-outer_frame_padding">outer_frame_padding</a></li>
      <li ><a href="#method-i-outer_frame_radius">outer_frame_radius</a></li>
      <li ><a href="#method-i-outer_rect">outer_rect</a></li>
      <li ><a href="#method-i-outer_top_left">outer_top_left</a></li>
      <li ><a href="#method-i-pattern_layer_create">pattern_layer_create</a></li>
      <li ><a href="#method-i-pentagon_box_debug">pentagon_box_debug</a></li>
      <li ><a href="#method-i-pentagon_points">pentagon_points</a></li>
      <li ><a href="#method-i-pentagon_real_points">pentagon_real_points</a></li>
      <li ><a href="#method-i-piece_char_adjust">piece_char_adjust</a></li>
      <li ><a href="#method-i-piece_count_bg_draw">piece_count_bg_draw</a></li>
      <li ><a href="#method-i-piece_count_draw">piece_count_draw</a></li>
      <li ><a href="#method-i-piece_image_draw">piece_image_draw</a></li>
      <li ><a href="#method-i-piece_image_info">piece_image_info</a></li>
      <li ><a href="#method-i-piece_pentagon_draw">piece_pentagon_draw</a></li>
      <li ><a href="#method-i-piece_pentagon_scale">piece_pentagon_scale</a></li>
      <li ><a href="#method-i-ps">ps</a></li>
      <li ><a href="#method-i-px">px</a></li>
      <li ><a href="#method-i-render">render</a></li>
      <li ><a href="#method-i-round_radious">round_radious</a></li>
      <li ><a href="#method-i-soldier_draw">soldier_draw</a></li>
      <li ><a href="#method-i-soldier_draw_all">soldier_draw_all</a></li>
      <li ><a href="#method-i-soldier_draw_by_char">soldier_draw_by_char</a></li>
      <li ><a href="#method-i-soldier_draw_by_image">soldier_draw_by_image</a></li>
      <li ><a href="#method-i-soldier_font_scale">soldier_font_scale</a></li>
      <li ><a href="#method-i-soldier_move_cell_draw">soldier_move_cell_draw</a></li>
      <li ><a href="#method-i-soldier_name">soldier_name</a></li>
      <li ><a href="#method-i-stand_draw">stand_draw</a></li>
      <li ><a href="#method-i-star_draw">star_draw</a></li>
      <li ><a href="#method-i-star_fill_color">star_fill_color</a></li>
      <li ><a href="#method-i-texture_image">texture_image</a></li>
      <li ><a href="#method-i-to_blob_binary">to_blob_binary</a></li>
      <li ><a href="#method-i-to_png24_binary">to_png24_binary</a></li>
      <li ><a href="#method-i-to_write_binary">to_write_binary</a></li>
      <li ><a href="#method-i-top_left">top_left</a></li>
      <li ><a href="#method-i-transparent_layer">transparent_layer</a></li>
      <li ><a href="#method-i-turn_draw">turn_draw</a></li>
      <li ><a href="#method-i-v_bottom_right_outer">v_bottom_right_outer</a></li>
      <li ><a href="#method-i-v_top_left_outer">v_top_left_outer</a></li>
      <li ><a href="#method-i-vmin">vmin</a></li>
      <li ><a href="#method-i-with_shadow">with_shadow</a></li>
      <li ><a href="#method-i-with_shadow_only_font_pice">with_shadow_only_font_pice</a></li>
    </ul>
  </div>



  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.10.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="module-Bioshogi::ScreenImage">
  <h1 id="module-Bioshogi::ScreenImage" class="anchor-link module">
    module Bioshogi::ScreenImage
  </h1>

  <section class="description">
    
  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">





     <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-new" title="Link to this method">
                <span class="method-name">new</span>
                <span class="method-args">(container, params = {})</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">params</span> = {})
  <span class="ruby-comment"># params.assert_valid_keys(default_params.keys)</span>

  <span class="ruby-ivar">@container</span> = <span class="ruby-identifier">container</span>
  <span class="ruby-ivar">@params</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">default_params</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">params</span>)

  <span class="ruby-comment"># 一つ一つのパラメータを設定するのは大変である</span>
  <span class="ruby-comment"># そこで以下を設定するとまとまったパラメータを一気に設定する</span>
  <span class="ruby-comment"># - color_theme_key</span>
  <span class="ruby-comment"># - font_theme_key</span>
  <span class="ruby-comment"># - piece_font_weight_key</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">e</span> = <span class="ruby-constant">ColorThemeInfo</span>.<span class="ruby-identifier">lookup</span>(<span class="ruby-ivar">@params</span>[<span class="ruby-value">:color_theme_key</span>])
    <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_params</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">e</span> = <span class="ruby-constant">FontThemeInfo</span>.<span class="ruby-identifier">lookup</span>(<span class="ruby-ivar">@params</span>[<span class="ruby-value">:font_theme_key</span>])
    <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_params</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">e</span> = <span class="ruby-constant">PieceFontWeightInfo</span>.<span class="ruby-identifier">lookup</span>(<span class="ruby-ivar">@params</span>[<span class="ruby-value">:piece_font_weight_key</span>])
    <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_params</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># 最終的に調整したいときは renderer_override_params に指定するとすべてを上書きできる</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> = <span class="ruby-ivar">@params</span>[<span class="ruby-value">:renderer_override_params</span>]
    <span class="ruby-ivar">@params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@build_counter</span> = <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-c-renderer" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-c-renderer" title="Link to this method">
                <span class="method-name">renderer</span>
                <span class="method-args">(...)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="renderer-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image.rb, line 7</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">renderer</span>(<span class="ruby-operator">...</span>)
  <span class="ruby-constant">Renderer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">...</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-board_layer_create" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-board_layer_create" title="Link to this method">
                <span class="method-name">board_layer_create</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="board_layer_create-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">board_layer_create</span>
  <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">transparent_layer</span>(<span class="ruby-value">:s_board_layer</span>)
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fg_file</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">false</span>
      <span class="ruby-comment"># 座標を見ずに画面中央に表示する場合</span>
      <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">composite!</span>(<span class="ruby-identifier">texture_image</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">CenterGravity</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># 自分で座標を指定すると1ドット左に寄っているように見えるので ceil で補正している</span>
      <span class="ruby-comment"># https://rmagick.github.io/image1.html#composite</span>
      <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">composite!</span>(<span class="ruby-identifier">texture_image</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">outer_top_left</span>).<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:ceil</span>), <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">draw_context</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_stroke_width</span>].<span class="ruby-identifier">nonzero?</span>
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_stroke_color</span>])
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_stroke_width</span>])
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_fill_color</span>]
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">roundrectangle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">outer_top_left</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">outer_bottom_right</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">round_radious</span>) <span class="ruby-comment"># stroke_width に応じてずれる心配なし</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cell_colors</span>].<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">colors</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">v</span>).<span class="ruby-identifier">cycle</span>
    <span class="ruby-identifier">cell_walker</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">color</span> = <span class="ruby-identifier">colors</span>.<span class="ruby-identifier">next</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">color</span>
        <span class="ruby-identifier">draw_context</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span> = <span class="ruby-identifier">color</span>
          <span class="ruby-comment"># NOTE: 格子が1pxの場合に隙間ができるため minus_one しない方がよさそう</span>
          <span class="ruby-keyword">if</span> <span class="ruby-keyword">false</span>
            <span class="ruby-identifier">g</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">minus_one</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span>))) <span class="ruby-comment"># 隙間ができる</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">g</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span>)) <span class="ruby-comment"># 正確ではないが隙間ができない</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">with_shadow</span>(<span class="ruby-identifier">layer</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>盤 padding を入れる場合 or 盤画像</p>
        </div>


      </div>

      <div id="method-i-canvas_layer_create" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-canvas_layer_create" title="Link to this method">
                <span class="method-name">canvas_layer_create</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="canvas_layer_create-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">canvas_layer_create</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>
    <span class="ruby-comment"># layer = Magick::Image.read(&quot;logo:&quot;).first</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">ASSETS_DIR</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;images/matrix_1024x768.png&quot;</span>)).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">Pathname</span>(<span class="ruby-string">&quot;~/Pictures/ぱくたそ/IS107112702_TP_V.jpg&quot;</span>).<span class="ruby-identifier">expand_path</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-constant">CanvasPattern</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:pattern_checker_grey_dark</span>).<span class="ruby-identifier">func</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">copy</span>
    <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">resize!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">image_rect</span>) <span class="ruby-comment"># 200 ms</span>
    <span class="ruby-comment"># layer.blur_image(20.0, 10.0)</span>
    <span class="ruby-comment"># layer = layer.emboss</span>
    <span class="ruby-comment"># layer = Magick::Image.read(&quot;netscape:&quot;).first.resize(*image_rect)</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">condition_then_flip</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-comment"># 全体を反転するので背景だけ反転しておくことで元に戻る</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:bg_file</span>]
    <span class="ruby-identifier">layer</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">v</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-comment"># layer.resize_to_fit!(*image_rect)  # 指定したサイズより(画像が小さいと)画像のサイズになる</span>
    <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">resize_to_fill!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">image_rect</span>) <span class="ruby-comment"># アス比を維持して中央を切り取る</span>
    <span class="ruby-comment"># layer.resize!(*image_rect) # 200 ms</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">condition_then_flip</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-comment"># 全体を反転するので背景だけ反転しておくことで元に戻る</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">image_rect</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">background_color</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:canvas_bg_color</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># 白黒の場合 GRAYColorspace になっていてこれに盤を重ねると白黒になってしまう、のを防ぐ</span>
  <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">colorspace</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">SRGBColorspace</span>

  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-string">&quot;canvas_layer_create for s_canvas_layer&quot;</span> }

  <span class="ruby-identifier">layer</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-cell_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-cell_draw" title="Link to this method">
                <span class="method-name">cell_draw</span>
                <span class="method-args">(g, v)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="cell_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cell_draw</span>(<span class="ruby-identifier">g</span>, <span class="ruby-identifier">v</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-cell_h" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-cell_h" title="Link to this method">
                <span class="method-name">cell_h</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="cell_h-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cell_h</span>
  <span class="ruby-ivar">@cell_h</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">vmin</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspect_ratio_h</span>]) <span class="ruby-operator">/</span> <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-cell_rect" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-cell_rect" title="Link to this method">
                <span class="method-name">cell_rect</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="cell_rect-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 276</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cell_rect</span>
  <span class="ruby-ivar">@cell_rect</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Rect</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cell_w</span>, <span class="ruby-identifier">cell_h</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-cell_vmin" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-cell_vmin" title="Link to this method">
                <span class="method-name">cell_vmin</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="cell_vmin-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cell_vmin</span>
  <span class="ruby-ivar">@cell_vmin</span> <span class="ruby-operator">||=</span> [<span class="ruby-identifier">cell_w</span>, <span class="ruby-identifier">cell_h</span>].<span class="ruby-identifier">min</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>セルサイズの短い方</p>
        </div>


      </div>

      <div id="method-i-cell_w" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-cell_w" title="Link to this method">
                <span class="method-name">cell_w</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="cell_w-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cell_w</span>
  <span class="ruby-ivar">@cell_w</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">vmin</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspect_ratio_w</span>]) <span class="ruby-operator">/</span> <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-cell_walker" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-cell_walker" title="Link to this method">
                <span class="method-name">cell_walker</span>
                <span class="method-args">() { |V| ... }</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="cell_walker-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cell_walker</span>
  <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">yield</span> <span class="ruby-constant">V</span>[<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-center" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-center" title="Link to this method">
                <span class="method-name">center</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="center-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">center</span>
  <span class="ruby-ivar">@center</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">V</span>[<span class="ruby-ivar">@s_canvas_layer</span>.<span class="ruby-identifier">columns</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>, <span class="ruby-ivar">@s_canvas_layer</span>.<span class="ruby-identifier">rows</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-char_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-char_draw" title="Link to this method">
                <span class="method-name">char_draw</span>
                <span class="method-args">(layer: nil, v:, text:, location:, font_scale:, color: params[:piece_font_color], bold: false, stroke_width: nil, stroke_color: nil)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="char_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">char_draw</span>(<span class="ruby-value">layer:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">v:</span>, <span class="ruby-value">text:</span>, <span class="ruby-value">location:</span>, <span class="ruby-value">font_scale:</span>, <span class="ruby-value">color:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_font_color</span>], <span class="ruby-value">bold:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">stroke_width:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">stroke_color:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">g</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Draw</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">rotation</span> = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">angle</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">pointsize</span> = <span class="ruby-identifier">cell_w</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">font_scale</span>

  <span class="ruby-identifier">font</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">bold</span>
    <span class="ruby-identifier">font</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:font_bold</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">font</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:font_regular</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">font</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">font</span> = <span class="ruby-identifier">font</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">stroke_width</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">stroke_color</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span> = <span class="ruby-identifier">stroke_width</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>       = <span class="ruby-identifier">stroke_color</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span> = <span class="ruby-identifier">color</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">gravity</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">CenterGravity</span> <span class="ruby-comment"># annotate で指定した範囲の中央に描画する</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">annotate</span>(<span class="ruby-identifier">layer</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">cell_rect</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span>), <span class="ruby-identifier">text</span>) <span class="ruby-comment"># annotate(image, w, h, x, y, text)</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-clear_all" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-clear_all" title="Link to this method">
                <span class="method-name">clear_all</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="clear_all-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/layer_methods.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear_all</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">tagged</span>(<span class="ruby-value">:clear_all</span>) <span class="ruby-keyword">do</span>
    [
      <span class="ruby-value">:s_canvas_layer</span>,
      <span class="ruby-value">:s_board_layer</span>,
      <span class="ruby-value">:s_lattice_layer</span>,

      <span class="ruby-value">:d_move_layer</span>,
      <span class="ruby-value">:d_piece_layer</span>,
      <span class="ruby-value">:d_piece_count_layer</span>,
      <span class="ruby-value">:d_turn_layer</span>,

      <span class="ruby-value">:last_rendered_image</span>,
    ].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-node">&quot;@#{e}&quot;</span>)
        <span class="ruby-identifier">v</span>.<span class="ruby-identifier">destroy!</span>
        <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-node">&quot;@#{e}&quot;</span>, <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;@#{e}.destroy!&quot;</span> }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>いらない？</p>
        </div>


      </div>

      <div id="method-i-condition_then_color_negate" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-condition_then_color_negate" title="Link to this method">
                <span class="method-name">condition_then_color_negate</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="condition_then_color_negate-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 204</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">condition_then_color_negate</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:negate</span>]
    <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">negate</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">layer</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-condition_then_flip" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-condition_then_flip" title="Link to this method">
                <span class="method-name">condition_then_flip</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="condition_then_flip-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">condition_then_flip</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:viewpoint</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;white&quot;</span>
    <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">rotate</span>(<span class="ruby-value">180</span>) <span class="ruby-comment"># 5 ms</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">layer</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-current_place" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-current_place" title="Link to this method">
                <span class="method-name">current_place</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="current_place-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">current_place</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hand_log</span>
    <span class="ruby-identifier">soldier</span> = <span class="ruby-identifier">hand_log</span>.<span class="ruby-identifier">soldier</span>
    <span class="ruby-constant">V</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">hand_log</span>.<span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">place</span>.<span class="ruby-identifier">to_xy</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-d" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-d" title="Link to this method">
                <span class="method-name">d</span>
                <span class="method-args">(image)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="d-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">d</span>(<span class="ruby-identifier">image</span>)
  <span class="ruby-node">`open #{o(image)}`</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>d Magick::Image.read(“logo:”).first</p>
        </div>


      </div>

      <div id="method-i-default_params" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-default_params" title="Link to this method">
                <span class="method-name">default_params</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="default_params-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 5</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">default_params</span>
  <span class="ruby-keyword">super</span>.<span class="ruby-identifier">merge</span>({
      <span class="ruby-comment"># 必須</span>
      <span class="ruby-value">:width</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-value">1200</span>, <span class="ruby-comment"># 画像横幅</span>
      <span class="ruby-value">:height</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">630</span>,  <span class="ruby-comment"># 画像縦幅</span>

      <span class="ruby-comment"># 将棋盤の比率</span>
      <span class="ruby-comment"># 実際の比率は 横:33.3 縦:36.4</span>
      <span class="ruby-comment"># 高さ最大を1.0として隙間を考慮して 0.95 と仮に決めると</span>
      <span class="ruby-comment"># 0.95 * (33.3 / 36.4) で横幅は 0.8690934065934065 になる</span>
      <span class="ruby-value">:aspect_ratio_w</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0.8690934065934065</span>, <span class="ruby-comment"># 縦横幅の小さい方に対する盤の横幅の割合(横長の場合縦比率より小さめにする)</span>
      <span class="ruby-value">:aspect_ratio_h</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0.95</span>,               <span class="ruby-comment"># 縦横幅の小さい方に対する盤の縦幅の割合(横長の場合1.0にすると縦の隙間がなくなる)</span>

      <span class="ruby-comment"># 文字の大きさの割合</span>
      <span class="ruby-comment"># ※割合はすべてセルの大きさを1.0とする</span>
      <span class="ruby-value">:soldier_font_scale</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0.85</span>, <span class="ruby-comment"># PieceScale に掛ける共通倍率。かなり印象が変わる。1.00 だと暑苦しい。</span>
      <span class="ruby-value">:piece_scale_map</span>    <span class="ruby-operator">=&gt;</span> {},

      <span class="ruby-comment"># 駒(文字)の位置調整</span>
      <span class="ruby-value">:piece_char_adjust</span> <span class="ruby-operator">=&gt;</span> {
        <span class="ruby-value">:black</span> <span class="ruby-operator">=&gt;</span> [<span class="ruby-value">0.0425</span>, <span class="ruby-value">0.07</span>],
        <span class="ruby-value">:white</span> <span class="ruby-operator">=&gt;</span> [<span class="ruby-value">0.0</span>,    <span class="ruby-value">0.01</span>],
      },

      <span class="ruby-comment"># 盤</span>
      <span class="ruby-value">:canvas_bg_color</span>          <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;hsla(0,0%,100%,1.0)&quot;</span>,            <span class="ruby-comment"># 部屋の色(必須)</span>
      <span class="ruby-value">:piece_font_color</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;hsla(0,0%,0%,0.8)&quot;</span>,              <span class="ruby-comment"># 駒の色(必須)</span>
      <span class="ruby-value">:lattice_stroke_width</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-value">1</span>,                                <span class="ruby-comment"># 格子の線の太さ</span>
      <span class="ruby-value">:inner_frame_stroke_width</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2</span>,                                <span class="ruby-comment"># 枠の線お太さ(nil なら lattice_stroke_width を代用)</span>
      <span class="ruby-value">:inner_frame_fill_color</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,                              <span class="ruby-comment"># 基本透明とする(基本指定なしでよい)</span>
      <span class="ruby-value">:dimension_w</span>              <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Dimension</span><span class="ruby-operator">::</span><span class="ruby-constant">Column</span>.<span class="ruby-identifier">dimension_size</span>, <span class="ruby-comment"># 横のセル数</span>
      <span class="ruby-value">:dimension_h</span>              <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Dimension</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span>.<span class="ruby-identifier">dimension_size</span>,    <span class="ruby-comment"># 縦のセル数</span>
      <span class="ruby-value">:fg_file</span>                  <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,                              <span class="ruby-comment"># 盤テクスチャ</span>

      <span class="ruby-comment"># optional</span>
      <span class="ruby-value">:last_soldier_font_color</span>    <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,                     <span class="ruby-comment"># *最後に動いた駒の色。基本指定しない。(nilなら piece_font_color を代用)</span>
      <span class="ruby-value">:stand_piece_color</span>          <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,                     <span class="ruby-comment"># *持駒の色(nilなら piece_font_color を代用)</span>
      <span class="ruby-value">:inner_frame_lattice_color</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;hsla(0,0%,0%,0.6)&quot;</span>,     <span class="ruby-comment"># *格子の色(nilなら piece_font_color を代用)</span>
      <span class="ruby-value">:inner_frame_stroke_color</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;hsla(0,0%,0%,0.6)&quot;</span>,     <span class="ruby-comment"># *格子の外枠色(nilなら piece_font_color を代用) これだけで全体イメージが変わる超重要色</span>
      <span class="ruby-value">:promoted_font_color</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;hsla(0,100%, 50%,0.8)&quot;</span>, <span class="ruby-comment"># *成駒の色(nilなら piece_font_color を代用)</span>

      <span class="ruby-value">:outer_frame_padding</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>,                           <span class="ruby-comment"># 盤の余白</span>
      <span class="ruby-value">:outer_frame_radius</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0.05</span>,                        <span class="ruby-comment"># 盤の角の丸め</span>
      <span class="ruby-value">:outer_frame_fill_color</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;transparent&quot;</span>,               <span class="ruby-comment"># 盤の色</span>
      <span class="ruby-value">:outer_frame_stroke_color</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;transparent&quot;</span>,               <span class="ruby-comment"># 外枠の縁取り色(鬼滅盤用)</span>
      <span class="ruby-value">:outer_frame_stroke_width</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>,                           <span class="ruby-comment"># 外枠の縁取り幅(鬼滅盤用)</span>

      <span class="ruby-value">:cell_colors</span>                <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,                         <span class="ruby-comment"># セルの色 複数指定可</span>
      <span class="ruby-value">:piece_move_cell_fill_color</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;hsla(0,0%,0%,0.05)&quot;</span>,        <span class="ruby-comment"># 移動元と移動先のセルの背景色(nilなら描画しない)</span>
      <span class="ruby-value">:normal_piece_color_map</span>     <span class="ruby-operator">=&gt;</span> {},                          <span class="ruby-comment"># 成ってない駒それぞれの色(nilなら piece_font_color を代用)</span>

      <span class="ruby-comment"># フォント駒</span>
      <span class="ruby-value">:font_theme_key</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,                                                  <span class="ruby-comment"># フォントの種類 noto_seif</span>
      <span class="ruby-value">:font_regular</span>          <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">ASSETS_DIR</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;fonts/RictyDiminished-Regular.ttf&quot;</span>), <span class="ruby-comment"># 駒のフォント(普通)</span>
      <span class="ruby-value">:font_bold</span>             <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">ASSETS_DIR</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;fonts/RictyDiminished-Bold.ttf&quot;</span>),    <span class="ruby-comment"># 駒のフォント(太字) (shogi-extendから直接参照しているためnilにしてはいけない)</span>
      <span class="ruby-value">:soldier_font_bold</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>,                                                <span class="ruby-comment"># 太字を使うか？</span>
      <span class="ruby-value">:piece_font_weight_key</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:is_piece_font_weight_auto</span>,                           <span class="ruby-comment"># 太字はおまかせ (つまり何もしない。nil でもよい)</span>

      <span class="ruby-comment"># 画像駒</span>
      <span class="ruby-value">:piece_image_key</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-comment"># どの画像駒を使うか？ (nil なら使わない)</span>
      <span class="ruby-value">:piece_image_scale</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-comment"># 画像駒の大きさ (nil なら PieceImageInfo の default_scale を使う)</span>

      <span class="ruby-comment"># other</span>
      <span class="ruby-value">:viewpoint</span>    <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;black&quot;</span>, <span class="ruby-comment"># 視点</span>
      <span class="ruby-value">:image_format</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;png&quot;</span>,   <span class="ruby-comment"># 出力する画像タイプ</span>
      <span class="ruby-value">:negate</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>,   <span class="ruby-comment"># 反転</span>
      <span class="ruby-value">:bg_file</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,     <span class="ruby-comment"># 背景ファイル</span>

      <span class="ruby-comment"># star</span>
      <span class="ruby-value">:star_size</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0.03</span>, <span class="ruby-comment"># 星のサイズ(割合)</span>
      <span class="ruby-value">:star_fill_color</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>,  <span class="ruby-comment"># *星の色(nilなら inner_frame_lattice_color を代用)</span>
      <span class="ruby-value">:star_step</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-value">3</span>,    <span class="ruby-comment"># 星はnセルごとに書く</span>

      <span class="ruby-value">:color_theme_key</span>          <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;is_color_theme_modern&quot;</span>, <span class="ruby-comment"># 色テーマ</span>
      <span class="ruby-value">:renderer_override_params</span> <span class="ruby-operator">=&gt;</span> {},                      <span class="ruby-comment"># 色テーマを上書きするパラメータ</span>
    })
<span class="ruby-keyword">end</span></pre>
          </div>
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
        </div>


      </div>

      <div id="method-i-display" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-display" title="Link to this method">
                <span class="method-name">display</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="display-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 17</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">display</span>
  <span class="ruby-identifier">d</span>(<span class="ruby-identifier">render</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-draw_context" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-draw_context" title="Link to this method">
                <span class="method-name">draw_context</span>
                <span class="method-args">(layer) { |g| ... }</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="draw_context-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">draw_context</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-identifier">g</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Draw</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">g</span>
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">draw</span>(<span class="ruby-identifier">layer</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>draw の時点で最後に指定した fill が使われる</p>
        </div>


      </div>

      <div id="method-i-dynamic_layer_setup" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-dynamic_layer_setup" title="Link to this method">
                <span class="method-name">dynamic_layer_setup</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="dynamic_layer_setup-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/layer_methods.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dynamic_layer_setup</span>
  <span class="ruby-ivar">@d_move_layer</span>        = <span class="ruby-identifier">transparent_layer</span>(<span class="ruby-value">:d_move_layer</span>)
  <span class="ruby-ivar">@d_piece_layer</span>       = <span class="ruby-identifier">transparent_layer</span>(<span class="ruby-value">:d_piece_layer</span>)
  <span class="ruby-ivar">@d_piece_count_layer</span> = <span class="ruby-identifier">transparent_layer</span>(<span class="ruby-value">:d_piece_count_layer</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-ext_name" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-ext_name" title="Link to this method">
                <span class="method-name">ext_name</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="ext_name-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ext_name</span>
  <span class="ruby-identifier">image_format</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-face_pentagon_color" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-face_pentagon_color" title="Link to this method">
                <span class="method-name">face_pentagon_color</span>
                <span class="method-args">(location)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="face_pentagon_color-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 154</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">face_pentagon_color</span>(<span class="ruby-identifier">location</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:face_pentagon_color</span>][<span class="ruby-identifier">location</span>.<span class="ruby-identifier">key</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-face_pentagon_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-face_pentagon_draw" title="Link to this method">
                <span class="method-name">face_pentagon_draw</span>
                <span class="method-args">(v:, location:)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="face_pentagon_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 84</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">face_pentagon_draw</span>(<span class="ruby-value">v:</span>, <span class="ruby-value">location:</span>)
  <span class="ruby-identifier">draw_context</span>(<span class="ruby-ivar">@d_piece_layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">color</span> = <span class="ruby-identifier">face_pentagon_color</span>(<span class="ruby-identifier">location</span>)
    <span class="ruby-identifier">w</span> = <span class="ruby-identifier">face_pentagon_stroke_width</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">w</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">nonzero?</span>
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-identifier">color</span>[<span class="ruby-value">:stroke</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_stroke_color</span>])
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-identifier">w</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-identifier">color</span>[<span class="ruby-value">:fill</span>])
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">polygon</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">pentagon_real_points</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>, <span class="ruby-value">scale:</span> <span class="ruby-identifier">face_pentagon_scale</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>☗を白黒で塗り分ける</p>
        </div>


      </div>

      <div id="method-i-face_pentagon_scale" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-face_pentagon_scale" title="Link to this method">
                <span class="method-name">face_pentagon_scale</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="face_pentagon_scale-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">face_pentagon_scale</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:face_pentagon_scale</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">piece_pentagon_scale</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>turn</p>
        </div>


      </div>

      <div id="method-i-face_pentagon_stroke_width" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-face_pentagon_stroke_width" title="Link to this method">
                <span class="method-name">face_pentagon_stroke_width</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="face_pentagon_stroke_width-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">face_pentagon_stroke_width</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:face_pentagon_stroke_width</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_stroke_width</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-image_basename" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-image_basename" title="Link to this method">
                <span class="method-name">image_basename</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="image_basename-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_model_methods.rb, line 5</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">image_basename</span>
  [
    <span class="ruby-identifier">location</span>.<span class="ruby-identifier">to_sfen</span>,     <span class="ruby-comment"># B (Black)</span>
    <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">sfen_char</span>,      <span class="ruby-comment"># P (Pawn)</span>
    <span class="ruby-identifier">promoted</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;1&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-comment"># 0 (不成)</span>
  ].<span class="ruby-identifier">join</span>.<span class="ruby-identifier">upcase</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>対応する画像のファイル名を返す</p>
        </div>


      </div>

      <div id="method-i-image_format" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-image_format" title="Link to this method">
                <span class="method-name">image_format</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="image_format-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">image_format</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:image_format</span>].<span class="ruby-identifier">presence</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;params[:image_format] is blank&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-image_rect" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-image_rect" title="Link to this method">
                <span class="method-name">image_rect</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="image_rect-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 251</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">image_rect</span>
  <span class="ruby-ivar">@image_rect</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Rect</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:width</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:height</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-inner_frame_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-inner_frame_draw" title="Link to this method">
                <span class="method-name">inner_frame_draw</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="inner_frame_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inner_frame_draw</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">inner_frame_stroke_width</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:inner_frame_fill_color</span>]
    <span class="ruby-identifier">draw_context</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-identifier">inner_frame_stroke_color</span>)
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-identifier">inner_frame_stroke_width</span>)
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:inner_frame_fill_color</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;transparent&quot;</span>
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-constant">V</span>[<span class="ruby-value">0</span>, <span class="ruby-value">0</span>]), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-constant">V</span>[<span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>, <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>])) <span class="ruby-comment"># QUESTION: 右下は -1, -1 するべきか？</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>格子の外枠盤から見れば内側基本透明で枠だけを描画する塗り潰したいときは <a href="ScreenImage.html#method-i-board_layer_create"><code>board_layer_create</code></a> の方で行うべきinner_frame_stroke_width が 0 または nil で inner_frame_fill_color も nil ならスキップ</p>
        </div>


      </div>

      <div id="method-i-inner_frame_lattice_color" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-inner_frame_lattice_color" title="Link to this method">
                <span class="method-name">inner_frame_lattice_color</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="inner_frame_lattice_color-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inner_frame_lattice_color</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:inner_frame_lattice_color</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_font_color</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-inner_frame_stroke_color" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-inner_frame_stroke_color" title="Link to this method">
                <span class="method-name">inner_frame_stroke_color</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="inner_frame_stroke_color-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inner_frame_stroke_color</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:inner_frame_stroke_color</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_font_color</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-inner_frame_stroke_width" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-inner_frame_stroke_width" title="Link to this method">
                <span class="method-name">inner_frame_stroke_width</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="inner_frame_stroke_width-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 300</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inner_frame_stroke_width</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:inner_frame_stroke_width</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">lattice_stroke_width</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-lattice" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-lattice" title="Link to this method">
                <span class="method-name">lattice</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="lattice-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 255</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lattice</span>
  <span class="ruby-ivar">@lattice</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Rect</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:dimension_w</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:dimension_h</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-lattice_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-lattice_draw" title="Link to this method">
                <span class="method-name">lattice_draw</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="lattice_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 19</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lattice_draw</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-identifier">draw_context</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-identifier">lattice_stroke_width</span>) <span class="ruby-comment"># 2px 以上の場合はこれがいる</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-identifier">inner_frame_lattice_color</span>)  <span class="ruby-comment"># (↑のときの色)</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span> = <span class="ruby-identifier">inner_frame_lattice_color</span>   <span class="ruby-comment"># 線の中心線の色(1pxだけならこれだけあればいい)</span>

    (<span class="ruby-value">1</span><span class="ruby-operator">...</span><span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">line_draw</span>(<span class="ruby-identifier">g</span>, <span class="ruby-constant">V</span>[<span class="ruby-identifier">x</span>, <span class="ruby-value">0</span>], <span class="ruby-constant">V</span>[<span class="ruby-identifier">x</span>, <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>])
    <span class="ruby-keyword">end</span>
    (<span class="ruby-value">1</span><span class="ruby-operator">...</span><span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">line_draw</span>(<span class="ruby-identifier">g</span>, <span class="ruby-constant">V</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">y</span>], <span class="ruby-constant">V</span>[<span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>, <span class="ruby-identifier">y</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>外枠を含まない格子line で stroke を使うと fill + stroke で二重に同じところを塗るっぽいだから半透明にしても濃くなるなので fill だけにするしかし、そうすると今度は 2px 以上が描画できなくなるのでやっぱり stroke も入れておく</p>
        </div>


      </div>

      <div id="method-i-lattice_layer_create" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-lattice_layer_create" title="Link to this method">
                <span class="method-name">lattice_layer_create</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="lattice_layer_create-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 6</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lattice_layer_create</span>
  <span class="ruby-identifier">transparent_layer</span>(<span class="ruby-value">:s_lattice_layer</span>).<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lattice_draw</span>(<span class="ruby-identifier">e</span>)
    <span class="ruby-identifier">inner_frame_draw</span>(<span class="ruby-identifier">e</span>)
    <span class="ruby-identifier">star_draw</span>(<span class="ruby-identifier">e</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-lattice_stroke_width" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-lattice_stroke_width" title="Link to this method">
                <span class="method-name">lattice_stroke_width</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="lattice_stroke_width-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 296</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lattice_stroke_width</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:lattice_stroke_width</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-line_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-line_draw" title="Link to this method">
                <span class="method-name">line_draw</span>
                <span class="method-args">(g, v1, v2)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="line_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">line_draw</span>(<span class="ruby-identifier">g</span>, <span class="ruby-identifier">v1</span>, <span class="ruby-identifier">v2</span>)
  <span class="ruby-identifier">g</span>.<span class="ruby-identifier">line</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v1</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v2</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-minus_one" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-minus_one" title="Link to this method">
                <span class="method-name">minus_one</span>
                <span class="method-args">(x, y)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="minus_one-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">minus_one</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>)
  [<span class="ruby-identifier">x</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">y</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-next_build" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-next_build" title="Link to this method">
                <span class="method-name">next_build</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="next_build-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 12</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">next_build</span>
  <span class="ruby-ivar">@last_rendered_image</span> = <span class="ruby-identifier">render</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-o" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-o" title="Link to this method">
                <span class="method-name">o</span>
                <span class="method-args">(image, name = nil)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="o-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">o</span>(<span class="ruby-identifier">image</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">name</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">hex</span>
  <span class="ruby-identifier">file</span> = <span class="ruby-constant">Bundler</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;tmp/#{name}.png&quot;</span>).<span class="ruby-identifier">expand_path</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">dirname</span>)
  <span class="ruby-identifier">image</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">file</span>
  <span class="ruby-identifier">file</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>o Magick::Image.read(“logo:”).first</p>
        </div>


      </div>

      <div id="method-i-origin_place" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-origin_place" title="Link to this method">
                <span class="method-name">origin_place</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="origin_place-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">origin_place</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hand_log</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">hand_log</span>.<span class="ruby-identifier">hand</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hand</span><span class="ruby-operator">::</span><span class="ruby-constant">Move</span>)
      <span class="ruby-constant">V</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">hand_log</span>.<span class="ruby-identifier">hand</span>.<span class="ruby-identifier">origin_soldier</span>.<span class="ruby-identifier">place</span>.<span class="ruby-identifier">to_xy</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-outer_bottom_right" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-outer_bottom_right" title="Link to this method">
                <span class="method-name">outer_bottom_right</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="outer_bottom_right-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 336</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">outer_bottom_right</span>
  <span class="ruby-constant">V</span>[<span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>, <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">outer_frame_padding</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>外側の左下</p>
        </div>


      </div>

      <div id="method-i-outer_frame_padding" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-outer_frame_padding" title="Link to this method">
                <span class="method-name">outer_frame_padding</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="outer_frame_padding-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 321</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">outer_frame_padding</span>
  <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_padding</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>盤の外側とセルの隙間</p>
        </div>


      </div>

      <div id="method-i-outer_frame_radius" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-outer_frame_radius" title="Link to this method">
                <span class="method-name">outer_frame_radius</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="outer_frame_radius-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 312</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">outer_frame_radius</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_padding</span>].<span class="ruby-identifier">zero?</span>
    <span class="ruby-value">0</span> <span class="ruby-comment"># 隙間が無い場合は線だけの角なので丸めるとセルが削れる。なので強制的に0</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:outer_frame_radius</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-outer_rect" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-outer_rect" title="Link to this method">
                <span class="method-name">outer_rect</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="outer_rect-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 341</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">outer_rect</span>
  <span class="ruby-identifier">outer_bottom_right</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">outer_top_left</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>外側の領域</p>
        </div>


      </div>

      <div id="method-i-outer_top_left" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-outer_top_left" title="Link to this method">
                <span class="method-name">outer_top_left</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="outer_top_left-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 331</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">outer_top_left</span>
  <span class="ruby-constant">V</span>[<span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">outer_frame_padding</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>外側の左上</p>
        </div>


      </div>

      <div id="method-i-pattern_layer_create" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-pattern_layer_create" title="Link to this method">
                <span class="method-name">pattern_layer_create</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="pattern_layer_create-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pattern_layer_create</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:pt_file</span>].<span class="ruby-identifier">presence</span>
    <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">Pathname</span>(<span class="ruby-identifier">v</span>).<span class="ruby-identifier">expand_path</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-pentagon_box_debug" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-pentagon_box_debug" title="Link to this method">
                <span class="method-name">pentagon_box_debug</span>
                <span class="method-args">(v)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="pentagon_box_debug-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pentagon_box_debug</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-identifier">draw_context</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-value">1</span>)
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-string">&quot;#000&quot;</span>)
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-string">&quot;transparent&quot;</span>)
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">rectangle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-pentagon_points" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-pentagon_points" title="Link to this method">
                <span class="method-name">pentagon_points</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="pentagon_points-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pentagon_points</span>
  <span class="ruby-ivar">@pentagon_points</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">yield_self</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">e</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:pentagon_profile</span>]
    [
      [<span class="ruby-value">0.0</span>,            <span class="ruby-operator">-</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:kaonaga</span>]],  <span class="ruby-comment"># 頂点</span>
      [<span class="ruby-operator">-</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:katahaba</span>],  <span class="ruby-operator">-</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:munenaga</span>]], <span class="ruby-comment"># 左肩</span>
      [<span class="ruby-operator">-</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:hunbari</span>],   <span class="ruby-operator">+</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:asinaga</span>]],  <span class="ruby-comment"># 左後</span>
      [<span class="ruby-operator">+</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:hunbari</span>],   <span class="ruby-operator">+</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:asinaga</span>]],  <span class="ruby-comment"># 右後</span>
      [<span class="ruby-operator">+</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:katahaba</span>],  <span class="ruby-operator">-</span><span class="ruby-identifier">e</span>[<span class="ruby-value">:munenaga</span>]], <span class="ruby-comment"># 右肩</span>
    ].<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
      [
        <span class="ruby-identifier">x</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cell_w</span> <span class="ruby-operator">*</span> <span class="ruby-value">0.5</span>,
        <span class="ruby-identifier">y</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cell_h</span> <span class="ruby-operator">*</span> <span class="ruby-value">0.5</span>,
      ]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>相対座標で☖の一周分pentagon_real_points の方で行う計算で固定のものはこちらで先に行っておく</p>
        </div>


      </div>

      <div id="method-i-pentagon_real_points" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-pentagon_real_points" title="Link to this method">
                <span class="method-name">pentagon_real_points</span>
                <span class="method-args">(v:, location:, scale: 1.0)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="pentagon_real_points-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pentagon_real_points</span>(<span class="ruby-value">v:</span>, <span class="ruby-value">location:</span>, <span class="ruby-value">scale:</span> <span class="ruby-value">1.0</span>)
  <span class="ruby-identifier">cx</span>, <span class="ruby-identifier">cy</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">half</span>)  <span class="ruby-comment"># 中央</span>
  <span class="ruby-identifier">pentagon_points</span>.<span class="ruby-identifier">flat_map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
    [
      <span class="ruby-identifier">cx</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">scale</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">sign_dir</span>,
      <span class="ruby-identifier">cy</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">y</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">scale</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">sign_dir</span>,
    ]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>実座標化OPTIMIZE: cx, cy を除いた部分だけキャッシュした方がよくない？</p>
        </div>


      </div>

      <div id="method-i-piece_char_adjust" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_char_adjust" title="Link to this method">
                <span class="method-name">piece_char_adjust</span>
                <span class="method-args">(location)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_char_adjust-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_char_adjust</span>(<span class="ruby-identifier">location</span>)
  <span class="ruby-ivar">@piece_char_adjust</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-ivar">@piece_char_adjust</span>[<span class="ruby-identifier">location</span>.<span class="ruby-identifier">key</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">V</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_char_adjust</span>][<span class="ruby-identifier">location</span>.<span class="ruby-identifier">key</span>]] <span class="ruby-operator">*</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">sign_dir</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>フォントの位置を微調整</p>
        </div>


      </div>

      <div id="method-i-piece_count_bg_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_count_bg_draw" title="Link to this method">
                <span class="method-name">piece_count_bg_draw</span>
                <span class="method-args">(v:, location:)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_count_bg_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/stand.rb, line 107</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_count_bg_draw</span>(<span class="ruby-value">v:</span>, <span class="ruby-value">location:</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_bg_color</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_bg_scale</span>].<span class="ruby-identifier">nonzero?</span>
    <span class="ruby-identifier">draw_context</span>(<span class="ruby-ivar">@d_piece_count_layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_bg_color</span>])

      <span class="ruby-comment"># v2 = v + V[*params[:piece_count_bg_adjust][w]] * location.sign_dir</span>
      <span class="ruby-comment"># v2 = v + (V.half + V[*params[:piece_count_bg_adjust]]) * location.sign_dir</span>
      <span class="ruby-comment"># g.ellipse(*px(v2), *(cell_rect * params[:piece_count_bg_scale] * location.sign_dir), 0, 360) # x, y, w, h, angle(0 to 360)</span>
      <span class="ruby-comment"># g.ellipse(*px(v2), *cell_rect, 0, 360) # x, y, w, h, angle(0 to 360)</span>

      <span class="ruby-comment"># 個数は左上を原点とした枠の中心(CenterGravity)で表示するのでその位置に移動する</span>
      <span class="ruby-identifier">from</span> = <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">half</span>                                               <span class="ruby-comment"># 中心に移動</span>
      <span class="ruby-comment"># from += V[*params[:piece_count_bg_adjust][location.key]] # 微調整</span>
      <span class="ruby-comment"># fromを基点として大きさを決める</span>
      <span class="ruby-identifier">to</span> = <span class="ruby-identifier">from</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">half</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_bg_scale</span>]
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">circle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">from</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">to</span>)) <span class="ruby-comment"># (x1, y1) と (x2, y2) の2点を通る円</span>

      <span class="ruby-comment"># roundrectangle でも円風にできるけど原点が左上なので半径の調整が難しい</span>

      <span class="ruby-comment"># ellipse より roundrectangle の方が扱いやすい？</span>
      <span class="ruby-comment"># g.roundrectangle(*px(v + V.one * 0.25), *px(v + V.one), *(cell_rect * 0.25))</span>
      <span class="ruby-comment"># roundrectangle2(g, v)</span>
      <span class="ruby-comment"># g.rectangle(*px(v), *px(v + V.one * params[:piece_count_bg_scale] * s)) # debug</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>駒数の下の丸</p>
        </div>


      </div>

      <div id="method-i-piece_count_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_count_draw" title="Link to this method">
                <span class="method-name">piece_count_draw</span>
                <span class="method-args">(v:, count:, location:)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_count_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/stand.rb, line 87</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_count_draw</span>(<span class="ruby-value">v:</span>, <span class="ruby-value">count:</span>, <span class="ruby-value">location:</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">w</span> = <span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">9</span> <span class="ruby-operator">?</span> <span class="ruby-value">:single</span> <span class="ruby-operator">:</span> <span class="ruby-value">:double</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_position_adjust</span>][<span class="ruby-identifier">w</span>]] <span class="ruby-operator">*</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">sign_dir</span>
    <span class="ruby-identifier">piece_count_bg_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>)
    <span class="ruby-identifier">char_draw</span>(
      <span class="ruby-value">:layer</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@d_piece_count_layer</span>,
      <span class="ruby-value">:v</span>            <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">v</span>,
      <span class="ruby-value">:text</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">count</span>.<span class="ruby-identifier">to_s</span>,
      <span class="ruby-value">:location</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">location</span>,
      <span class="ruby-value">:color</span>        <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_font_color</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_font_color</span>], <span class="ruby-comment"># 地べたに描画するのでコントラスト比を下げるの重要</span>
      <span class="ruby-value">:font_scale</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_font_scale</span>],
      <span class="ruby-value">:stroke_color</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_stroke_color</span>],
      <span class="ruby-value">:stroke_width</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_stroke_width</span>],
      <span class="ruby-value">:bold</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_count_bold</span>],
      )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>駒数</p>
        </div>


      </div>

      <div id="method-i-piece_image_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_image_draw" title="Link to this method">
                <span class="method-name">piece_image_draw</span>
                <span class="method-args">(v:, soldier:)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_image_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_image_draw</span>(<span class="ruby-value">v:</span>, <span class="ruby-value">soldier:</span>)
  <span class="ruby-identifier">piece_path</span> = <span class="ruby-identifier">piece_image_info</span>.<span class="ruby-identifier">piece_path</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-identifier">scale</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_image_scale</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">piece_image_info</span>.<span class="ruby-identifier">default_scale</span>
  <span class="ruby-identifier">wh</span> = (<span class="ruby-identifier">cell_rect</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">scale</span>).<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:ceil</span>)               <span class="ruby-comment"># =&gt; [105, 114]</span>
  <span class="ruby-identifier">cache_key</span> = [<span class="ruby-identifier">piece_path</span>, <span class="ruby-identifier">wh</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;x&quot;</span>)].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;,&quot;</span>)       <span class="ruby-comment"># =&gt; &quot;nureyon/BP0,105x114&quot;</span>

  <span class="ruby-ivar">@piece_image_draw</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-identifier">image</span> = <span class="ruby-ivar">@piece_image_draw</span>[<span class="ruby-identifier">cache_key</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">yield_self</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">full_path</span> = <span class="ruby-constant">ASSETS_DIR</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;images/piece/#{piece_path}.#{piece_image_info.ext_name}&quot;</span>)
    <span class="ruby-identifier">image</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">full_path</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">image</span>.<span class="ruby-identifier">resize_to_fill</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">wh</span>)                            <span class="ruby-comment"># 描画領域の大きさに調整(縮小)させる</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">top_left</span> = <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span> <span class="ruby-operator">*</span> (<span class="ruby-value">1.0</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">scale</span>) <span class="ruby-operator">/</span> <span class="ruby-value">2</span> <span class="ruby-comment"># スケールが 0.8 なら左上から右下方向に 0.1 の位置から描画すればセルの真ん中に配置できる</span>
  <span class="ruby-ivar">@d_piece_layer</span>.<span class="ruby-identifier">composite!</span>(<span class="ruby-identifier">image</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">top_left</span>), <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-piece_image_info" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_image_info" title="Link to this method">
                <span class="method-name">piece_image_info</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_image_info-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 346</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_image_info</span>
  <span class="ruby-ivar">@piece_image_info</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">PieceImageInfo</span>.<span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_image_key</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>portella, nureyon などの情報</p>
        </div>


      </div>

      <div id="method-i-piece_pentagon_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_pentagon_draw" title="Link to this method">
                <span class="method-name">piece_pentagon_draw</span>
                <span class="method-args">(v:, location:, piece: nil)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_pentagon_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_pentagon_draw</span>(<span class="ruby-value">v:</span>, <span class="ruby-value">location:</span>, <span class="ruby-value">piece:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_draw</span>]
    <span class="ruby-comment"># pentagon_box_debug(v)</span>
    <span class="ruby-identifier">draw_context</span>(<span class="ruby-ivar">@d_piece_layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">w</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_stroke_width</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">w</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">nonzero?</span>
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_stroke_color</span>])
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-identifier">w</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@s_pattern_layer</span>
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill_pattern</span> = <span class="ruby-ivar">@s_pattern_layer</span> <span class="ruby-comment"># テクスチャが足りない場合は繰り返し敷き詰められる。だいたい64pxあればよい。余裕を見て 128x128 で作ろう</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_fill_color</span>])
      <span class="ruby-identifier">g</span>.<span class="ruby-identifier">polygon</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">pentagon_real_points</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>, <span class="ruby-value">scale:</span> <span class="ruby-identifier">piece_pentagon_scale</span>(<span class="ruby-identifier">piece</span>)))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-piece_pentagon_scale" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-piece_pentagon_scale" title="Link to this method">
                <span class="method-name">piece_pentagon_scale</span>
                <span class="method-args">(piece)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="piece_pentagon_scale-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/pentagon.rb, line 140</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">piece_pentagon_scale</span>(<span class="ruby-identifier">piece</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_pentagon_scale</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">scale</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>piece</p>
        </div>


      </div>

      <div id="method-i-ps" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-ps" title="Link to this method">
                <span class="method-name">ps</span>
                <span class="method-args">(v)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="ps-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ps</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-identifier">v</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cell_rect</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>pixel size</p>
        </div>


      </div>

      <div id="method-i-px" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-px" title="Link to this method">
                <span class="method-name">px</span>
                <span class="method-args">(v)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="px-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">px</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-identifier">top_left</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ps</span>(<span class="ruby-identifier">v</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>メモ化の効果なし</p>
        </div>


      </div>

      <div id="method-i-render" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-render" title="Link to this method">
                <span class="method-name">render</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="render-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">render</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">tagged</span>(<span class="ruby-ivar">@build_counter</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;rmagick&quot;</span>

    <span class="ruby-ivar">@hand_log</span> = <span class="ruby-identifier">container</span>.<span class="ruby-identifier">hand_logs</span>.<span class="ruby-identifier">last</span>

    <span class="ruby-comment"># たまたまレイヤー単位でまとめられたけど本当はレイヤーを気にせずに「やりたいこと単位」でまとめるべき</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;static layer&quot;</span>
    <span class="ruby-ivar">@s_canvas_layer</span>  <span class="ruby-operator">||=</span> <span class="ruby-identifier">canvas_layer_create</span>
    <span class="ruby-ivar">@s_board_layer</span>   <span class="ruby-operator">||=</span> <span class="ruby-identifier">board_layer_create</span>
    <span class="ruby-ivar">@s_lattice_layer</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">lattice_layer_create</span>
    <span class="ruby-ivar">@s_pattern_layer</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">pattern_layer_create</span>

    <span class="ruby-comment"># こちらの stand_draw を見ればレイヤー単位でまとめるのは難しいことがわかる</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;dynamic layer&quot;</span>
    <span class="ruby-identifier">dynamic_layer_setup</span>
    <span class="ruby-identifier">soldier_move_cell_draw</span>  <span class="ruby-comment"># to d_move_layer</span>
    <span class="ruby-identifier">soldier_draw_all</span>        <span class="ruby-comment"># to d_piece_layer</span>
    <span class="ruby-identifier">stand_draw</span>              <span class="ruby-comment"># to d_piece_layer, d_piece_count_layer</span>

    <span class="ruby-comment"># メモリが足りないとこのどこかで落ちる</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;composite&quot;</span>
    <span class="ruby-identifier">current</span> = <span class="ruby-ivar">@s_canvas_layer</span>.<span class="ruby-identifier">composite</span>(<span class="ruby-ivar">@s_board_layer</span>,      <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>) <span class="ruby-comment"># 背景 + 物&#39;</span>
    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">composite</span>(<span class="ruby-ivar">@d_move_layer</span>,               <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>) <span class="ruby-comment"># 背景 + 物&#39;</span>
    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">composite</span>(<span class="ruby-ivar">@s_lattice_layer</span>,            <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>) <span class="ruby-comment"># 背景 + 物&#39;</span>
    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">composite</span>(<span class="ruby-identifier">with_shadow_only_font_pice</span>(<span class="ruby-ivar">@d_piece_layer</span>), <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>) <span class="ruby-comment"># 背景 + 物&#39;</span>
    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">composite</span>(<span class="ruby-ivar">@d_piece_count_layer</span>,        <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>) <span class="ruby-comment"># 背景 + 物&#39;</span>

    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;condition_then_flip&quot;</span>
    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">condition_then_flip</span>(<span class="ruby-identifier">current</span>)

    <span class="ruby-identifier">turn_draw</span>(<span class="ruby-identifier">current</span>)    <span class="ruby-comment"># レイヤーを作らず直接書き込み</span>

    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">condition_then_color_negate</span>(<span class="ruby-identifier">current</span>) <span class="ruby-comment"># 色反転</span>

    <span class="ruby-ivar">@build_counter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">current</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-round_radious" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-round_radious" title="Link to this method">
                <span class="method-name">round_radious</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="round_radious-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 326</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">round_radious</span>
  <span class="ruby-identifier">cell_rect</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">outer_frame_radius</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>角の丸め度合い</p>
        </div>


      </div>

      <div id="method-i-soldier_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_draw" title="Link to this method">
                <span class="method-name">soldier_draw</span>
                <span class="method-args">(soldier)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_draw</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">piece_image_info</span>
    <span class="ruby-identifier">soldier_draw_by_image</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">soldier_draw_by_char</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-soldier_draw_all" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_draw_all" title="Link to this method">
                <span class="method-name">soldier_draw_all</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_draw_all-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 4</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_draw_all</span>
  <span class="ruby-identifier">container</span>.<span class="ruby-identifier">board</span>.<span class="ruby-identifier">soldiers</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-value">:soldier_draw</span>))                                                                                <span class="ruby-comment"># 駒を描画</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-soldier_draw_by_char" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_draw_by_char" title="Link to this method">
                <span class="method-name">soldier_draw_by_char</span>
                <span class="method-args">(soldier)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_draw_by_char-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_draw_by_char</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-identifier">v</span> = <span class="ruby-constant">V</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">place</span>.<span class="ruby-identifier">to_xy</span>]
  <span class="ruby-identifier">location</span> = <span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">location</span>
  <span class="ruby-identifier">color</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">bold</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hand_log</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">soldier</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">hand_log</span>.<span class="ruby-identifier">soldier</span>
    <span class="ruby-identifier">color</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:last_soldier_font_color</span>]
    <span class="ruby-identifier">bold</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">promoted</span>
    <span class="ruby-identifier">color</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:promoted_font_color</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">piece_pentagon_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>, <span class="ruby-value">piece:</span> <span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">piece</span>) <span class="ruby-comment"># ☗☖</span>

  <span class="ruby-identifier">char_draw</span>(
    <span class="ruby-value">:layer</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@d_piece_layer</span>,
    <span class="ruby-value">:v</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">piece_char_adjust</span>(<span class="ruby-identifier">location</span>),
    <span class="ruby-value">:text</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">soldier_name</span>(<span class="ruby-identifier">soldier</span>),
    <span class="ruby-value">:location</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">location</span>,
    <span class="ruby-value">:color</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">color</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:normal_piece_color_map</span>][<span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">piece</span>.<span class="ruby-identifier">key</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_font_color</span>],
    <span class="ruby-value">:bold</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">bold</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:soldier_font_bold</span>],
    <span class="ruby-value">:font_scale</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">soldier_font_scale</span>(<span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">piece</span>),
    )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-soldier_draw_by_image" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_draw_by_image" title="Link to this method">
                <span class="method-name">soldier_draw_by_image</span>
                <span class="method-args">(soldier)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_draw_by_image-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_draw_by_image</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-identifier">v</span> = <span class="ruby-constant">V</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">place</span>.<span class="ruby-identifier">to_xy</span>]
  <span class="ruby-identifier">piece_image_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">soldier:</span> <span class="ruby-identifier">soldier</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-soldier_font_scale" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_font_scale" title="Link to this method">
                <span class="method-name">soldier_font_scale</span>
                <span class="method-args">(piece)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_font_scale-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_font_scale</span>(<span class="ruby-identifier">piece</span>)
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:soldier_font_scale</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">scale</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-soldier_move_cell_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_move_cell_draw" title="Link to this method">
                <span class="method-name">soldier_move_cell_draw</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_move_cell_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_move_cell_draw</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_move_cell_fill_color</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">hand_log</span>
      <span class="ruby-identifier">draw_context</span>(<span class="ruby-ivar">@d_move_layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-string">&quot;transparent&quot;</span>)
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_move_cell_fill_color</span>]
        <span class="ruby-identifier">cell_draw</span>(<span class="ruby-identifier">g</span>, <span class="ruby-identifier">current_place</span>)
        <span class="ruby-identifier">cell_draw</span>(<span class="ruby-identifier">g</span>, <span class="ruby-identifier">origin_place</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-soldier_name" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-soldier_name" title="Link to this method">
                <span class="method-name">soldier_name</span>
                <span class="method-args">(soldier)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="soldier_name-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/soldier_methods.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">soldier_name</span>(<span class="ruby-identifier">soldier</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">piece</span>.<span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-value">:king</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-value">:white</span>
    <span class="ruby-string">&quot;王&quot;</span>                  <span class="ruby-comment"># FIXME: ハードコーディングすんな</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">soldier</span>.<span class="ruby-identifier">any_name</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-stand_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-stand_draw" title="Link to this method">
                <span class="method-name">stand_draw</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="stand_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/stand.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">stand_draw</span>
  <span class="ruby-identifier">g</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:stand_piece_line_height</span>]

  <span class="ruby-identifier">container</span>.<span class="ruby-identifier">players</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">player</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">location</span> = <span class="ruby-identifier">player</span>.<span class="ruby-identifier">location</span>
    <span class="ruby-identifier">s</span> = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">sign_dir</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">player</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-value">:black</span>
      <span class="ruby-identifier">v</span> = <span class="ruby-identifier">v_bottom_right_outer</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">v</span> = <span class="ruby-identifier">v_top_left_outer</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">h</span> = <span class="ruby-constant">V</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">player</span>.<span class="ruby-identifier">piece_box</span>.<span class="ruby-identifier">count</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">g</span>       <span class="ruby-comment"># 駒数に対応した高さ</span>
    <span class="ruby-identifier">v</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">s</span>                                 <span class="ruby-comment"># 右下から右端中央にずらす</span>
    <span class="ruby-identifier">v</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">V</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value">:stand_board_gap</span>], <span class="ruby-value">0</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">s</span>    <span class="ruby-comment"># 盤と持駒の隙間を開ける</span>

    <span class="ruby-identifier">face_pentagon_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>) <span class="ruby-comment"># ☗☖</span>

    <span class="ruby-identifier">v</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">V</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">g</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">s</span>

    <span class="ruby-identifier">player</span>.<span class="ruby-identifier">piece_box</span>.<span class="ruby-identifier">each</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span>(<span class="ruby-identifier">piece_key</span>, <span class="ruby-identifier">count</span>), <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">piece</span> = <span class="ruby-constant">Piece</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">piece_key</span>)

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_image_key</span>]
        <span class="ruby-identifier">soldier</span> = <span class="ruby-constant">Soldier</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>, <span class="ruby-value">piece:</span> <span class="ruby-identifier">piece</span>, <span class="ruby-value">promoted:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">place:</span> <span class="ruby-constant">Place</span>.<span class="ruby-identifier">zero</span>)
        <span class="ruby-identifier">piece_image_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">soldier:</span> <span class="ruby-identifier">soldier</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># 持駒の影</span>
        <span class="ruby-identifier">piece_pentagon_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>, <span class="ruby-value">piece:</span> <span class="ruby-identifier">piece</span>)

        <span class="ruby-comment"># 持駒</span>
        <span class="ruby-identifier">char_draw</span>(
            <span class="ruby-value">:layer</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@d_piece_layer</span>,
            <span class="ruby-value">:v</span>          <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">piece_char_adjust</span>(<span class="ruby-identifier">location</span>),
            <span class="ruby-value">:text</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">name</span>,
            <span class="ruby-value">:location</span>   <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">location</span>,
            <span class="ruby-value">:color</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:stand_piece_color</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:piece_font_color</span>],
            <span class="ruby-value">:font_scale</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:stand_piece_font_scale</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:soldier_font_scale</span>]) <span class="ruby-operator">*</span> <span class="ruby-identifier">piece</span>.<span class="ruby-identifier">scale</span>,
            <span class="ruby-value">:bold</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:stand_piece_font_bold</span>]
          )
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># 持駒数</span>
      <span class="ruby-identifier">piece_count_draw</span>(<span class="ruby-value">v:</span> <span class="ruby-identifier">v</span>, <span class="ruby-value">count:</span> <span class="ruby-identifier">count</span>, <span class="ruby-value">location:</span> <span class="ruby-identifier">location</span>)
      <span class="ruby-identifier">v</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">V</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">*</span> <span class="ruby-identifier">g</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">s</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-star_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-star_draw" title="Link to this method">
                <span class="method-name">star_draw</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="star_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">star_draw</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-identifier">draw_context</span>(<span class="ruby-identifier">layer</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-string">&quot;transparent&quot;</span>)
    <span class="ruby-identifier">g</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-identifier">star_fill_color</span>)

    <span class="ruby-identifier">i</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:star_step</span>]
    (<span class="ruby-identifier">i</span><span class="ruby-operator">...</span><span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>).<span class="ruby-identifier">step</span>(<span class="ruby-identifier">i</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      (<span class="ruby-identifier">i</span><span class="ruby-operator">...</span><span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span>).<span class="ruby-identifier">step</span>(<span class="ruby-identifier">i</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">v</span> = <span class="ruby-constant">V</span>[<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>]
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">circle</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">px</span>(<span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-constant">V</span>.<span class="ruby-identifier">one</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:star_size</span>]))
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-star_fill_color" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-star_fill_color" title="Link to this method">
                <span class="method-name">star_fill_color</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="star_fill_color-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">star_fill_color</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:star_fill_color</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">inner_frame_lattice_color</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-texture_image" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-texture_image" title="Link to this method">
                <span class="method-name">texture_image</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="texture_image-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/board_methods.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">texture_image</span>
  <span class="ruby-ivar">@texture_image</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">yield_self</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">image</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:fg_file</span>].<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">image</span>.<span class="ruby-identifier">resize_to_fill!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">ps</span>(<span class="ruby-identifier">outer_rect</span>))

    <span class="ruby-comment"># 角を取る場合</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">outer_frame_radius</span>.<span class="ruby-identifier">nonzero?</span>
      <span class="ruby-identifier">mask</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">image</span>.<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">image</span>.<span class="ruby-identifier">rows</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">background_color</span> = <span class="ruby-string">&quot;transparent&quot;</span> }
      <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Draw</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gc</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">gc</span>.<span class="ruby-identifier">stroke</span>(<span class="ruby-string">&quot;none&quot;</span>)
        <span class="ruby-identifier">gc</span>.<span class="ruby-identifier">stroke_width</span>(<span class="ruby-value">0</span>)
        <span class="ruby-identifier">gc</span>.<span class="ruby-identifier">fill</span>(<span class="ruby-string">&quot;white&quot;</span>) <span class="ruby-comment"># 透明以外であれば何でもよい</span>
        <span class="ruby-identifier">gc</span>.<span class="ruby-identifier">roundrectangle</span>(<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">mask</span>.<span class="ruby-identifier">columns</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">mask</span>.<span class="ruby-identifier">rows</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">round_radious</span>) <span class="ruby-comment"># 見たい部分を塗る</span>
        <span class="ruby-identifier">gc</span>.<span class="ruby-identifier">draw</span>(<span class="ruby-identifier">mask</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">image</span>.<span class="ruby-identifier">composite!</span>(<span class="ruby-identifier">mask</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">CopyAlphaCompositeOp</span>) <span class="ruby-comment"># 角が取れる</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">image</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>盤テクスチャ</p>
<ol><li>
<p>テクスチャと同じサイズの透明の画像を準備</p>
</li><li>
<p>透明画像で表示したい部分を塗り潰す (このとき角だけ透明になっている)</p>
</li><li>
<p>その透明画像が金型なので元のテクスチャに押し当てる (CopyAlphaCompositeOp)</p>
</li><li>
<p>角が取れたテクスチャが出来上がる</p>
</li></ol>
        </div>


      </div>

      <div id="method-i-to_blob_binary" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-to_blob_binary" title="Link to this method">
                <span class="method-name">to_blob_binary</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="to_blob_binary-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 24</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_blob_binary</span>
  <span class="ruby-identifier">image</span> = <span class="ruby-identifier">render</span>
  <span class="ruby-identifier">image</span>.<span class="ruby-identifier">format</span> = <span class="ruby-identifier">ext_name</span>
  <span class="ruby-identifier">image</span>.<span class="ruby-identifier">to_blob</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>png や gif は問題ないが apng や mp4 の場合に失敗する → ImageList#format に設定しているせいっぽいそもそも画像リストを write(“foo.png”) にすると foo-0.png foo-1.png などと複数生成されるのだからwrite は拡張子に合わせて format を設定して to_blob の結果を write しているのではないことがわかる</p>
        </div>


      </div>

      <div id="method-i-to_png24_binary" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-to_png24_binary" title="Link to this method">
                <span class="method-name">to_png24_binary</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="to_png24_binary-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_png24_binary</span>
  <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">create</span>([<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;.png&quot;</span>]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">render</span>.<span class="ruby-identifier">write</span>(<span class="ruby-node">&quot;PNG24:#{t.path}&quot;</span>)
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">t</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>PNG24 を強制する (for zip)</p>
        </div>


      </div>

      <div id="method-i-to_write_binary" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-to_write_binary" title="Link to this method">
                <span class="method-name">to_write_binary</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="to_write_binary-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/helper.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_write_binary</span>
  <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">create</span>([<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-node">&quot;.#{ext_name}&quot;</span>]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">render</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">t</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">t</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>いったんファイル出力してから戻している時点で相当無駄があるが apng や mp4 の場合でも失敗しない</p>
        </div>


      </div>

      <div id="method-i-top_left" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-top_left" title="Link to this method">
                <span class="method-name">top_left</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="top_left-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">top_left</span>
  <span class="ruby-ivar">@top_left</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">center</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">cell_rect</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">lattice</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-transparent_layer" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-transparent_layer" title="Link to this method">
                <span class="method-name">transparent_layer</span>
                <span class="method-args">(key)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="transparent_layer-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/layer_methods.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transparent_layer</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;transparent_layer create for #{key} BEGIN&quot;</span> }
  <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">image_rect</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">background_color</span> = <span class="ruby-string">&quot;transparent&quot;</span> }.<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;transparent_layer create for #{key} END&quot;</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-turn_draw" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-turn_draw" title="Link to this method">
                <span class="method-name">turn_draw</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="turn_draw-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/turn_methods.rb, line 12</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">turn_draw</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:turn_embed_key</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;is_turn_embed_on&quot;</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;turn_draw&quot;</span>

    <span class="ruby-identifier">pointsize</span> = <span class="ruby-identifier">cell_w</span> <span class="ruby-operator">*</span> <span class="ruby-value">0.75</span>
    <span class="ruby-identifier">w</span> = <span class="ruby-identifier">pointsize</span> <span class="ruby-operator">*</span> <span class="ruby-value">4</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-identifier">pointsize</span>
    <span class="ruby-identifier">x</span> = <span class="ruby-identifier">pointsize</span> <span class="ruby-operator">*</span> <span class="ruby-value">0.3</span>
    <span class="ruby-identifier">y</span> = <span class="ruby-identifier">pointsize</span> <span class="ruby-operator">*</span> <span class="ruby-value">0.1</span>

    <span class="ruby-comment"># r = cell_w * 0.5</span>
    <span class="ruby-comment"># @d_turn_layer = Magick::Image.new(w, h) { |e| e.background_color = &quot;transparent&quot; }</span>

    <span class="ruby-comment"># gc = Magick::Draw.new</span>
    <span class="ruby-comment"># gc.fill(params[:piece_count_bg_color])</span>
    <span class="ruby-comment"># from = [x + w/2, y + h/2]</span>
    <span class="ruby-comment"># to   = [x + w/2 + r, y + h/2]</span>
    <span class="ruby-comment"># gc.circle(*from, *to)</span>
    <span class="ruby-comment"># gc.draw(@d_turn_layer)</span>

    <span class="ruby-identifier">gc</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Draw</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">gc</span>.<span class="ruby-identifier">annotate</span>(<span class="ruby-identifier">layer</span>, <span class="ruby-identifier">w</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-node">&quot;#{@build_counter}&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">font</span>         = <span class="ruby-identifier">params</span>[<span class="ruby-value">:font_bold</span>].<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">fill</span>         = <span class="ruby-string">&quot;hsla(0,0%,100%,1.0)&quot;</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">pointsize</span>    = <span class="ruby-identifier">pointsize</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">stroke_width</span> = <span class="ruby-value">2</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">stroke</span>       = <span class="ruby-string">&quot;hsla(0,0%,0%,0.75)&quot;</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">gravity</span>      = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">NorthWestGravity</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-v_bottom_right_outer" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-v_bottom_right_outer" title="Link to this method">
                <span class="method-name">v_bottom_right_outer</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="v_bottom_right_outer-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 288</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">v_bottom_right_outer</span>
  <span class="ruby-ivar">@v_bottom_right_outer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">V</span>[<span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">w</span>, <span class="ruby-identifier">lattice</span>.<span class="ruby-identifier">h</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-v_top_left_outer" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-v_top_left_outer" title="Link to this method">
                <span class="method-name">v_top_left_outer</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="v_top_left_outer-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 292</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">v_top_left_outer</span>
  <span class="ruby-ivar">@v_top_left_outer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">V</span>[<span class="ruby-value">-1</span>, <span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-vmin" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-vmin" title="Link to this method">
                <span class="method-name">vmin</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="vmin-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/core_methods.rb, line 272</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">vmin</span>
  <span class="ruby-ivar">@vmin</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">image_rect</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">min</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>


      </div>

      <div id="method-i-with_shadow" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-with_shadow" title="Link to this method">
                <span class="method-name">with_shadow</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="with_shadow-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/layer_methods.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_shadow</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:real_shadow_sigma</span>].<span class="ruby-identifier">nonzero?</span>
    <span class="ruby-identifier">s</span> = <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">shadow</span>( <span class="ruby-comment"># https://rmagick.github.io/image3.html#shadow</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:real_shadow_offset</span>],
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:real_shadow_offset</span>],
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:real_shadow_sigma</span>],
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:real_shadow_opacity</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">false</span>
      <span class="ruby-comment"># 間違った方法</span>
      <span class="ruby-comment"># 影のレイヤーは内部のオフセットがずれているだけなのでこの方法ではオフセットが効いてないように見える</span>
      <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">composite</span>(<span class="ruby-identifier">layer</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">OverCompositeOp</span>) <span class="ruby-comment"># 影の上に乗せる</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># 意図した通りに重ねる</span>
      <span class="ruby-identifier">list</span> = <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageList</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">list</span>.<span class="ruby-identifier">new_image</span>(<span class="ruby-identifier">layer</span>.<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">layer</span>.<span class="ruby-identifier">rows</span>, <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">SolidFill</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;transparent&quot;</span>))
      <span class="ruby-identifier">list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
      <span class="ruby-identifier">list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">layer</span>
      <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">flatten_images</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">destroy!</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">layer</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>指定のレイヤーに影をつける</p>
        </div>


      </div>

      <div id="method-i-with_shadow_only_font_pice" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-with_shadow_only_font_pice" title="Link to this method">
                <span class="method-name">with_shadow_only_font_pice</span>
                <span class="method-args">(layer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="with_shadow_only_font_pice-source">
            <pre><span class="ruby-comment"># File lib/bioshogi/screen_image/layer_methods.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_shadow_only_font_pice</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">piece_image_info</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">piece_image_info</span>.<span class="ruby-identifier">custom_shadow_support</span>
      <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">with_shadow</span>(<span class="ruby-identifier">layer</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">layer</span> = <span class="ruby-identifier">with_shadow</span>(<span class="ruby-identifier">layer</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">layer</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>フォントでの駒のときだけ駒レイヤーに影をつける</p>
        </div>


      </div>

    </section>

  </section>
</main>

