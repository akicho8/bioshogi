require "./example_helper"

mediator = Sequencer.new
mediator.pattern = Dsl.define do
  board <<~EOT
  ９ ８ ７ ６ ５ ４ ３ ２ １
  +---------------------------+
    | ・ ・ ・ ・ ・ ・ ・v桂v香|一
  | ・ ・ ・ ・ ・v銀v金v角 ・|二
  | ・ ・ ・ ・ ・v歩v歩 ・v歩|三
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
  | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
  | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
  | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
  | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
  +---------------------------+
    EOT
  pieces "▲" => "歩1"
  auto_flushing {
    push {
      comment "成功するパターン"
      mov "▲２四歩"
      mov "△３一角"
      mov "▲２三歩成"
    }
    push {
      comment "最初に戻って失敗するパターン"
      mov "▲２三歩"
      mov "△３一角"
      mov "▲２二歩成"
      mov "△２二角"
    }
  }
end
mediator.evaluate
puts mediator.snapshots.collect(&:to_text)
# >> ----------------------------------------
# >> 棋譜: ▲２四歩
# >> 変数: {:auto_flushing=>true, :comment=>"成功するパターン"}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・ ・v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金v角 ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 ・v歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ 歩 ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:
# >> ----------------------------------------
# >> 棋譜: ▲２四歩 △３一角
# >> 変数: {:auto_flushing=>true, :comment=>nil}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・v角v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金 ・ ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 ・v歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ 歩 ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:
# >> ----------------------------------------
# >> 棋譜: ▲２四歩 △３一角 ▲２三歩成
# >> 変数: {:auto_flushing=>true, :comment=>nil}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・v角v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金 ・ ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 とv歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:
# >> ----------------------------------------
# >> 棋譜: ▲２三歩
# >> 変数: {:auto_flushing=>true, :comment=>"最初に戻って失敗するパターン"}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・ ・v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金v角 ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 歩v歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:
# >> ----------------------------------------
# >> 棋譜: ▲２三歩 △３一角
# >> 変数: {:auto_flushing=>true, :comment=>nil}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・v角v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金 ・ ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 歩v歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:
# >> ----------------------------------------
# >> 棋譜: ▲２三歩 △３一角 ▲２二歩成
# >> 変数: {:auto_flushing=>true, :comment=>nil}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・v角v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金 と ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 ・v歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:
# >> ----------------------------------------
# >> 棋譜: ▲２三歩 △３一角 ▲２二歩成 △同角
# >> 変数: {:auto_flushing=>true, :comment=>nil}
# >>   ９ ８ ７ ６ ５ ４ ３ ２ １
# >> +---------------------------+
# >> | ・ ・ ・ ・ ・ ・ ・v桂v香|一
# >> | ・ ・ ・ ・ ・v銀v金v角 ・|二
# >> | ・ ・ ・ ・ ・v歩v歩 ・v歩|三
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
# >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
# >> | ・ ・ ・ ・ ・ ・ 歩 ・ 歩|七
# >> | ・ ・ ・ ・ ・ ・ ・ 飛 ・|八
# >> | ・ ・ ・ ・ ・ ・ ・ 桂 香|九
# >> +---------------------------+
# >> 先手の持駒:
# >> 後手の持駒:歩
