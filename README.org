#+OPTIONS: toc:nil num:nil author:nil creator:nil \n:nil |:t
#+OPTIONS: @:t ::t ^:t -:t f:t *:t <:t

* 将棋のプログラム

  [[https://raw.github.com/akicho8/bushido/master/brawser/demo1.png]]

  DEMO → http://fast-plateau-7460.herokuapp.com/

  : frame = LiveFrame.start
  : frame.piece_plot
  : [
  :   "７六歩", "８四歩", "７八金", "３二金",
  :   "２六歩", "８五歩", "７七角", "３四歩",
  :   "８八銀", "７七角成",
  : ].each{|input|
  :   frame.execute(input)
  : }
  : puts frame.board
  : pp frame.simple_kif_logs
  : # >>   ９ ８ ７ ６ ５ ４ ３ ２ １
  : # >> +---------------------------+
  : # >> |v香v桂v銀v金v玉 ・v銀v桂v香|一
  : # >> | ・v飛 ・ ・ ・ ・v金 ・ ・|二
  : # >> |v歩 ・v歩v歩v歩v歩 ・v歩v歩|三
  : # >> | ・ ・ ・ ・ ・ ・v歩 ・ ・|四
  : # >> | ・v歩 ・ ・ ・ ・ ・ ・ ・|五
  : # >> | ・ ・ 歩 ・ ・ ・ ・ 歩 ・|六
  : # >> | 歩 歩v馬 歩 歩 歩 歩 ・ 歩|七
  : # >> | ・ 銀 金 ・ ・ ・ ・ 飛 ・|八
  : # >> | 香 桂 ・ ・ 玉 金 銀 桂 香|九
  : # >> +---------------------------+
  : # >> ["▲7六歩(77)",
  : # >>  "▽8四歩(83)",
  : # >>  "▲7八金(69)",
  : # >>  "▽3二金(41)",
  : # >>  "▲2六歩(27)",
  : # >>  "▽8五歩(84)",
  : # >>  "▲7七角(88)",
  : # >>  "▽3四歩(33)",
  : # >>  "▲8八銀(79)",
  : # >>  "▽7七角成(22)"]

** サンプルコード

*** 初期配置文字列のパース

    : info = Utils.parse_str("７六と")
    : info[:point].name # => "7六"
    : info[:promoted]   # => true
    : info[:piece].name # => "歩"

*** CPU同士の対局 (ルールを守った上でランダムに指してみる)

    : frame = LiveFrame.start
    : frame.piece_plot
    : while true
    :   way = frame.current_player.generate_way
    :   frame.execute(way)
    :   last_piece = frame.prev_player.last_piece
    :   if last_piece && last_piece.sym_name == :king
    :     break
    :   end
    : end

    : p frame
    : # >> 78手目: ▽後手番
    : # >>   ９ ８ ７ ６ ５ ４ ３ ２ １
    : # >> +---------------------------+
    : # >> | 角v桂v銀 ・v金 ・ ・ ・v香|一
    : # >> |v香 ・ ・ ・ ・v銀 ・ ・ 歩|二
    : # >> |v歩v歩v飛v歩 圭 ・ ・ ・v桂|三
    : # >> | ・ ・v歩 ・v金 ・ ・v歩 ・|四
    : # >> | ・ ・ ・ ・ 角 歩 ・ 歩v歩|五
    : # >> | ・ ・ 歩 ・ ・v歩v歩 ・ ・|六
    : # >> | 歩 歩 ・ 歩 歩 ・ ・ ・ 銀|七
    : # >> | 香 ・ ・ 金 ・ 飛 金 ・ 香|八
    : # >> | ・ 銀 ・ 玉 ・ ・ ・ 桂 ・|九
    : # >> +---------------------------+
    : # >> ▲先手の持駒:歩 玉
    : # >> ▽後手の持駒:歩

    : puts frame.human_kif_logs.group_by.with_index{|v, i|i / 8}.values.collect{|v|v.join(" ")}
    : # >> ▲3八金(39) ▽4六歩打 ▲1二歩打 ▽3六歩(35) ▲5三桂成(65)
    : # >> ▲4八玉 ▽5二金 ▲5六歩 ▽6二飛 ▲1六歩 ▽7二飛 ▲5九玉 ▽6二玉
    : # >> ▲2六歩 ▽4二金 ▲4八飛 ▽5四歩 ▲7八銀 ▽5一金 ▲7六歩 ▽5五歩
    : # >> ▲同歩 ▽3二金 ▲5八飛 ▽3四歩 ▲7七桂 ▽9二香 ▲1八飛 ▽4二金
    : # >> ▲6八金 ▽8二飛 ▲2八銀 ▽4四歩 ▲1五歩 ▽4三金 ▲1七銀 ▽2四歩
    : # >> ▲6五桂 ▽3三金 ▲9八香 ▽4二銀 ▲2八飛 ▽3一角 ▲2七飛 ▽5二玉
    : # >> ▲9九角 ▽4三金 ▲3九金 ▽4五歩 ▲8九銀 ▽1四歩 ▲5四歩 ▽1三桂
    : # >> ▲4六歩 ▽6二飛 ▲4五歩 ▽5四金 ▲5七歩打 ▽2二角 ▲1八香 ▽5三玉
    : # >> ▲2五歩 ▽7四歩 ▲6九玉 ▽5二飛 ▲2六飛 ▽4八歩打 ▲2八飛 ▽7二飛
    : # >> ▲4八飛 ▽5五角 ▲同角 ▽7三飛 ▲3六歩 ▽3五歩 ▲9一角打 ▽1五歩
    : # >> ▲3八金 ▽4六歩打 ▲1二歩打 ▽3六歩 ▲5三桂成

*** 第23期竜王戦七番勝負第6局の再生

    KIFファイルを読み込み

    : info = Bushido.parse(Pathname("ryuou20101214.kif"))
    : pp info.header
    : # >> {"対局ID"=>"333",
    : # >>  "開始日時"=>"2010/12/14 9:00",
    : # >>  "終了日時"=>"2010/12/15 19:13",
    : # >>  "表題"=>"竜王戦",
    : # >>  "棋戦"=>"第23期竜王戦七番勝負第6局",
    : # >>  "持ち時間"=>"各8時間",
    : # >>  "消費時間"=>"146▲479△471",
    : # >>  "場所"=>"岐阜・ホテルアソシア高山リゾート",
    : # >>  "手合割"=>"平手",
    : # >>  "先手"=>"羽生善治",
    : # >>  "後手"=>"渡辺　明"}

    棋譜を入力していく

    : frame = LiveFrame.start
    : frame.piece_plot
    : info.move_infos.each{|info|
    :   frame.execute(info[:input])
    : }

    最終形

    : puts frame.inspect
    : # >> 147:▲先手番
    : # >>   ９ ８ ７ ６ ５ ４ ３ ２ １
    : # >> +---------------------------+
    : # >> | ・v桂 ・ ・ 馬 ・ ・v桂v香|一
    : # >> |v飛 ・ ・ ・ ・ と ・ ・ ・|二
    : # >> | ・ ・ ・ 全v歩 ・v玉 ・ ・|三
    : # >> | ・ ・ ・ ・ ・ ・v桂 ・v金|四
    : # >> | ・v歩 ・ ・ ・ 銀v歩v歩v歩|五
    : # >> |v歩 ・ 歩v角 ・ ・ ・ ・ ・|六
    : # >> | ・ 歩 銀v歩vと ・ ・ ・ ・|七
    : # >> | 歩 ・ 玉 香 ・ ・ ・ ・ 香|八
    : # >> | 香 桂 ・ ・ ・ ・ 飛 ・ ・|九
    : # >> +---------------------------+
    : # >> blackの持駒:歩三金
    : # >> whiteの持駒:金二歩三銀

    KIF形式の棋譜確認

    : puts frame.simple_kif_logs.group_by.with_index{|v, i|i / 8}.values.collect{|v|v.join(" ")}
    : # >> ▲7六歩(77) ▽8四歩(83) ▲7八金(69) ▽3二金(41) ▲2六歩(27) ▽8五歩(84) ▲7七角(88) ▽3四歩(33)
    : # >> ▲8八銀(79) ▽7七角成(22) ▲7七銀(88) ▽4二銀(31) ▲3八銀(39) ▽7二銀(71) ▲9六歩(97) ▽9四歩(93)
    : # >> ▲4六歩(47) ▽6四歩(63) ▲4七銀(38) ▽6三銀(72) ▲6八玉(59) ▽3三銀(42) ▲5八金(49) ▽5四銀(63)
    : # >> ▲3六歩(37) ▽4二玉(51) ▲7九玉(68) ▽6五歩(64) ▲5六銀(47) ▽5二金(61) ▲1六歩(17) ▽1四歩(13)
    : # >> ▲3七桂(29) ▽3一玉(42) ▲4七金(58) ▽4四歩(43) ▲2五歩(26) ▽4三金(52) ▲8八玉(79) ▽2二玉(31)
    : # >> ▲4八金(47) ▽4二金(43) ▲2九飛(28) ▽4三金(42) ▲1八香(19) ▽9二香(91) ▲2八飛(29) ▽4二金(43)
    : # >> ▲2六飛(28) ▽5二金(42) ▲2九飛(26) ▽4三金(52) ▲2八飛(29) ▽4二金(43) ▲2七飛(28) ▽5二金(42)
    : # >> ▲4五歩(46) ▽4三金(52) ▲4四歩(45) ▽4四金(43) ▲2九飛(27) ▽4三金(44) ▲4六角打 ▽9三香(92)
    : # >> ▲4五歩打 ▽4二金(43) ▲4七銀(56) ▽9二飛(82) ▲3五歩(36) ▽3五歩(34) ▲3五角(46) ▽6四角打
    : # >> ▲5六歩(57) ▽9五歩(94) ▲9五歩(96) ▽9六歩打 ▲5七角(35) ▽9五香(93) ▲9八歩打 ▽3四歩打
    : # >> ▲3六銀(47) ▽7四歩(73) ▲1五歩(16) ▽1五歩(14) ▲2四歩(25) ▽2四銀(33) ▲2五銀(36) ▽4六歩打
    : # >> ▲2四銀(25) ▽2四歩(23) ▲8三銀打 ▽5二飛(92) ▲7四銀成(83) ▽9一角(64) ▲2四飛(29) ▽2三金(32)
    : # >> ▲2六飛(24) ▽2五歩打 ▲2五桂(37) ▽2四歩打 ▲1二歩打 ▽1二玉(22) ▲8四角(57) ▽4七歩成(46)
    : # >> ▲4七金(48) ▽1四金(23) ▲9五角(84) ▽2五歩(24) ▲3六飛(26) ▽2三玉(12) ▲5五歩(56) ▽4五銀(54)
    : # >> ▲3九飛(36) ▽4六歩打 ▲3六金(47) ▽3六銀(45) ▲3六飛(39) ▽4七歩成(46) ▲6三全(74) ▽9二飛(52)
    : # >> ▲5一角成(95) ▽6九銀打 ▲4五銀打 ▽2二桂打 ▲4三歩打 ▽3三金(42) ▲3五歩打 ▽3五歩(34)
    : # >> ▲3九飛(36) ▽7八銀成(69) ▲7八玉(88) ▽5五角(91) ▲3四歩打 ▽3四桂(22) ▲4二歩成(43) ▽5七と(47)
    : # >> ▲6九香打 ▽6六歩(65) ▲6六歩(67) ▽6八歩打 ▲6八香(69) ▽6七歩打 ▲4四銀打 ▽6六角(55)
    : # >> ▲3三銀成(44) ▽3三玉(23)

    KI2形式の棋譜確認

    : puts frame.human_kif_logs.group_by.with_index{|v, i|i / 8}.values.collect{|v|v.join(" ")}
    : # >> ▲7六歩 ▽8四歩 ▲7八金 ▽3二金 ▲2六歩 ▽8五歩 ▲7七角 ▽3四歩
    : # >> ▲8八銀 ▽7七角成 ▲同銀 ▽4二銀 ▲3八銀 ▽7二銀 ▲9六歩 ▽9四歩
    : # >> ▲4六歩 ▽6四歩 ▲4七銀 ▽6三銀 ▲6八玉 ▽3三銀 ▲5八金 ▽5四銀
    : # >> ▲3六歩 ▽4二玉 ▲7九玉 ▽6五歩 ▲5六銀 ▽5二金 ▲1六歩 ▽1四歩
    : # >> ▲3七桂 ▽3一玉 ▲4七金 ▽4四歩 ▲2五歩 ▽4三金 ▲8八玉 ▽2二玉
    : # >> ▲4八金 ▽4二金 ▲2九飛 ▽4三金 ▲1八香 ▽9二香 ▲2八飛 ▽4二金
    : # >> ▲2六飛 ▽5二金 ▲2九飛 ▽4三金 ▲2八飛 ▽4二金 ▲2七飛 ▽5二金
    : # >> ▲4五歩 ▽4三金 ▲4四歩 ▽同金 ▲2九飛 ▽4三金 ▲4六角打 ▽9三香
    : # >> ▲4五歩打 ▽4二金 ▲4七銀 ▽9二飛 ▲3五歩 ▽同歩 ▲同角 ▽6四角打
    : # >> ▲5六歩 ▽9五歩 ▲同歩 ▽9六歩打 ▲5七角 ▽9五香 ▲9八歩打 ▽3四歩打
    : # >> ▲3六銀 ▽7四歩 ▲1五歩 ▽同歩 ▲2四歩 ▽同銀 ▲2五銀 ▽4六歩打
    : # >> ▲2四銀 ▽同歩 ▲8三銀打 ▽5二飛 ▲7四銀成 ▽9一角 ▲2四飛 ▽2三金
    : # >> ▲2六飛 ▽2五歩打 ▲同桂 ▽2四歩打 ▲1二歩打 ▽同玉 ▲8四角 ▽4七歩成
    : # >> ▲同金 ▽1四金 ▲9五角 ▽2五歩 ▲3六飛 ▽2三玉 ▲5五歩 ▽4五銀
    : # >> ▲3九飛 ▽4六歩打 ▲3六金 ▽同銀 ▲同飛 ▽4七歩成 ▲6三全 ▽9二飛
    : # >> ▲5一角成 ▽6九銀打 ▲4五銀打 ▽2二桂打 ▲4三歩打 ▽3三金 ▲3五歩打 ▽同歩
    : # >> ▲3九飛 ▽7八銀成 ▲同玉 ▽5五角 ▲3四歩打 ▽同桂 ▲4二歩成 ▽5七と
    : # >> ▲6九香打 ▽6六歩 ▲同歩 ▽6八歩打 ▲同香 ▽6七歩打 ▲4四銀打 ▽6六角
    : # >> ▲3三銀成 ▽同玉

*** 駒が動ける場所

    : frame = BasicFrame.start
    : player = frame.player_at(:black)
    : player.initial_soldiers("５五馬")
    : player.soldiers.first.moveable_points.each{|point|
    :   player.initial_soldiers("#{point}馬", :from_piece => false)
    : }
    : puts frame.board
    : # >>   ９ ８ ７ ６ ５ ４ ３ ２ １
    : # >> +---------------------------+
    : # >> | 馬 ・ ・ ・ ・ ・ ・ ・ 馬|一
    : # >> | ・ 馬 ・ ・ ・ ・ ・ 馬 ・|二
    : # >> | ・ ・ 馬 ・ ・ ・ 馬 ・ ・|三
    : # >> | ・ ・ ・ 馬 馬 馬 ・ ・ ・|四
    : # >> | ・ ・ ・ 馬 馬 馬 ・ ・ ・|五
    : # >> | ・ ・ ・ 馬 馬 馬 ・ ・ ・|六
    : # >> | ・ ・ 馬 ・ ・ ・ 馬 ・ ・|七
    : # >> | ・ 馬 ・ ・ ・ ・ ・ 馬 ・|八
    : # >> | 馬 ・ ・ ・ ・ ・ ・ ・ 馬|九
    : # >> +---------------------------+

*** 座標のパース

    Pointクラス経由で扱えばだいたいパース可

    : Point["4三"].name   # => "4三"
    : Point["４三"].name  # => "4三"
    : Point["43"].name    # => "4三"

    内部では別の座標

    : Point["4三"].to_xy  # => [5, 2]

    引数が配列だったときのみスルー

    : Point[[5, 2]].to_xy # => [5, 2]

*** 駒の情報取得例

    : pp Piece["飛"].to_h
    : # >> {:name=>"飛",
    : # >>  :promoted_name=>"龍",
    : # >>  :basic_names=>["飛", "rook"],
    : # >>  :promoted_names=>["龍", "ROOK", "竜"],
    : # >>  :names=>["飛", "rook", "龍", "ROOK", "竜"],
    : # >>  :sym_name=>:rook,
    : # >>  :promotable?=>true,
    : # >>  :basic_step_vectors=>[],
    : # >>  :basic_series_vectors=>[nil, [0, -1], nil, [-1, 0], [1, 0], nil, [0, 1], nil],
    : # >>  :promoted_step_vectors=>
    : # >>   [[-1, -1], [0, -1], [1, -1], [-1, 0], nil, [1, 0], [-1, 1], [0, 1], [1, 1]],
    : # >>  :promoted_series_vectors=>[nil, [0, -1], nil, [-1, 0], [1, 0], nil, [0, 1], nil]}

*** 盤面テキストのパース

    : board = <<-EOT
    :   ９ ８ ７ ６ ５ ４ ３ ２ １
    : +---------------------------+
    : | ・v桂 ・ ・ 馬 ・ ・v桂v香|一
    : |v飛 ・ ・ ・ ・ と ・ ・ ・|二
    : | ・ ・ ・ 全v歩 ・v玉 ・ ・|三
    : | ・ ・ ・ ・ ・ ・v桂 ・v金|四
    : | ・v歩 ・ ・ ・ 銀v歩v歩v歩|五
    : |v歩 ・ 歩v角 ・ ・ ・ ・ ・|六
    : | ・ 歩 銀v歩vと ・ ・ ・ ・|七
    : | 歩 ・ 玉 香 ・ ・ ・ ・ 香|八
    : | 香 桂 ・ ・ ・ ・ 飛 ・ ・|九
    : +---------------------------+
    : EOT
    : BaseFormat.board_parse(board)
    : # => {
    :   :white => {
    :     "８一桂", "２一桂", "１一香", "９二飛", "５三歩", "３三玉", "３四桂", "１四金",
    :     "８五歩", "３五歩", "２五歩", "１五歩", "９六歩", "６六角", "６七歩", "５七と",
    :   },
    :   :black => {
    :     "５一馬", "４二と", "６三全", "４五銀", "７六歩", "８七歩", "７七銀", "９八歩",
    :     "７八玉", "６八香", "１八香", "９九香", "８九桂", "３九飛",
    :   },
    : }

*** KIF形式の盤面表示と盤面の駒の確認

    : frame = BasicFrame.start
    : frame.piece_plot
    : puts frame.board
    :
    : frame.board["５五"]      # => nil
    : frame.board["８八"].name # => "▲8八角"
    : frame.board["２八"].name # => "▲2八飛"
    : frame.board["５九"].name # => "▲5九玉"
    : # >>   ９ ８ ７ ６ ５ ４ ３ ２ １
    : # >> +---------------------------+
    : # >> |v香v桂v銀v金v玉v金v銀v桂v香|一
    : # >> | ・v飛 ・ ・ ・ ・ ・v角 ・|二
    : # >> |v歩v歩v歩v歩v歩v歩v歩v歩v歩|三
    : # >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
    : # >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
    : # >> | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
    : # >> | 歩 歩 歩 歩 歩 歩 歩 歩 歩|七
    : # >> | ・ 角 ・ ・ ・ ・ ・ 飛 ・|八
    : # >> | 香 桂 銀 金 玉 金 銀 桂 香|九
    : # >> +---------------------------+

*** ５五将棋の例

    : Board.size_change([5, 5])
    : frame = LiveFrame.start
    : soldiers = ["５五玉", "４五金", "３五銀", "２五角", "１五飛", "５四歩"]
    : frame.players.each do |player|
    :   _soldiers = soldiers.collect{|s|
    :     s = Utils.parse_str(s)
    :     s.merge(:point => s[:point].as_location(player.location))
    :   }
    :   player.initial_soldiers(_soldiers)
    : end
    : frame.piece_discard
    : p frame
    : # >> 1手目: ▲先手番
    : # >>   ５ ４ ３ ２ １
    : # >> +---------------+
    : # >> |v飛v角v銀v金v玉|一
    : # >> | ・ ・ ・ ・v歩|二
    : # >> | ・ ・ ・ ・ ・|三
    : # >> | 歩 ・ ・ ・ ・|四
    : # >> | 玉 金 銀 角 飛|五
    : # >> +---------------+
    : # >> ▲先手の持駒:
    : # >> ▽後手の持駒:
    :
    : frame.execute("２四銀")
    : frame.execute("４二銀")
    : frame.execute("３四角")
    : frame.execute("３二角")
    : frame.execute("２三銀")
    : frame.execute("４三銀")
    : frame.execute("１二銀")
    : frame.execute("同金")
    : frame.execute("同角")
    : p frame
    : # >> 10手目: ▽後手番
    : # >>   ５ ４ ３ ２ １
    : # >> +---------------+
    : # >> |v飛 ・ ・ ・v玉|一
    : # >> | ・ ・v角 ・ 角|二
    : # >> | ・v銀 ・ ・ ・|三
    : # >> | 歩 ・ ・ ・ ・|四
    : # >> | 玉 金 ・ ・ 飛|五
    : # >> +---------------+
    : # >> ▲先手の持駒:歩 金
    : # >> ▽後手の持駒:銀

** 仕様

*** 棋譜コマンドの解釈

    | コマンド | 意味               | 詳細                                                                       |
    |----------+--------------------+----------------------------------------------------------------------------|
    | 右       | 右の方のを選択     | 移動元を指定座標より右で絞る(龍馬は例外で指定座標を無視し左右の方向)       |
    | 左       | 左の方のを選択     | 移動元を指定座標より左で絞る(龍馬は例外で指定座標を無視し左右の方向)       |
    | 上       | 下の方のを上げる   | 移動元を指定座標より下で絞る                                               |
    | 引       | 上の方のを引く     | 移動元を指定座標より上で絞る。下げるから "下" と書いてしまいがちなので注意 |
    | 寄       | 横一列の中から選択 | 移動元を指定座標のY座標で絞る                                              |
    | 直       | 縦一列の中から選択 | 移動元を指定座標のX座標で絞る                                              |

    もっと簡単に

    :
    :           ↓引く
    :
    :                          右の方にあるやつ
    :
    :       ●    ← 寄せる
    :
    :
    :                ↑もち上げる
    :       ↑
    :       直
    :

*** 棋譜の表記

    #+ATTR_HTML: border="1" rules="all" frame="all"
    | 表記       | 意味                     |
    |------------+--------------------------|
    | ７六歩(77) | ７七の歩を７六に移動     |
    | ７六歩     | ７六歩(77) の省略形      |
    | ２二角成   | ２二に角が移動して成った |
    | ５五飛打   | ５五に持駒の飛車を打った |
    | 同歩       | 1手前の座標に歩を移動    |

*** 主な例外

    #+ATTR_HTML: border="1" rules="all" frame="all"
    | 例外                            | 意味                                         | どんなときに起きる？       |
    |---------------------------------+----------------------------------------------+----------------------------|
    | BushidoError                    | すべての例外の親                             |                            |
    | MovableSoldierNotFound          | 指定座標に移動できる駒が一つもない           | ７七に歩がないのに７六歩   |
    | AmbiguousFormatError            | 指定座標に移動できる駒が多くて特定できない   | 初手 "５八金"              |
    | SyntaxError                     | とりあえず表記が違う                         | 駒の配置時に４二銀成とした |
    | PointSyntaxError                | 座標の表記が違う                             | ４二のつもりで４と書いた   |
    | PositionSyntaxError             | 座標の桁の指定が違う                         | ４二のつもりで四２と書いた |
    | PieceNotFound                   | そんな名前の駒は存在しない                   | 龍のつもりで蛇と書いた     |
    | PieceAlredyExist                | 自分の駒の上に自分の駒を初期配置             | 配置時に2連続で "９七歩"   |
    | AlredyPromoted                  | すでに成っている                             | ５五の龍を５一飛成         |
    | BeforePointNotFound             | 同に対する座標が不明                         | 初手 "同歩"                |
    | SoldierEmpty                    | オプションで絞ったら移動できる駒がなくなった |                            |
    | RuleError                       | 反則                                         | 二歩など                   |

    反則系 (RuleError のサブクラス)

    #+ATTR_HTML: border="1" rules="all" frame="all"
    | 例外                            | 意味                                 | どんなときに起きる？               |
    |---------------------------------+--------------------------------------+------------------------------------|
    | DoublePawn                      | 二歩                                 | 歩がある縦列に歩を打った           |
    | NoPromotablePiece               | 「成」「不成」は指定できない         | １三金不成、３三玉成               |
    | NotFoundOnBoard                 | 盤面に指定の駒がない                 | ２七に歩がないのに２六歩(27)とした |
    | NotPromotable                   | 成れない条件で成ろうとした           | 初手 "７六歩成"                    |
    | NotPutInPlaceNotBeMoved         | 移動の見込みがない状態で駒を指せない | ▲１一桂                           |
    | PromotedPiecePutOnError         | 成った状態で打とうとした             | ５五龍打                           |
    | PromotedPieceToNormalPiece      | 成駒を成ってない状態に戻そうとした   | ５五龍を５六飛                     |
    | SamePlayerSoldierOverwrideError | 自分の駒の上に自分の駒を指した       | 初手 "８八飛(28)"                  |

*** 表示座標系

    #+ATTR_HTML: border="1" rules="all" frame="all"
    | 9   | 8 |   7 | 6 | 5 | 4 |   3 | 2 | 1   |    |
    |-----+---+-----+---+---+---+-----+---+-----+----|
    | 9一 |   |     |   |   |   |     |   | 1一 | 一 |
    |     |   |     |   |   |   |     |   |     | 二 |
    |     |   |     |   |   |   | 3三 |   | 1三 | 三 |
    |     |   |     |   |   |   |     |   |     | 四 |
    |     |   |     |   |   |   |     |   |     | 五 |
    |     |   |     |   |   |   |     |   |     | 六 |
    |     |   | 7七 |   |   |   |     |   |     | 七 |
    |     |   |     |   |   |   |     |   |     | 八 |
    | 9九 |   |     |   |   |   |     |   | 1九 | 九 |

*** コード座標系

    #+ATTR_HTML: border="1" rules="all" frame="all"
    |   | 0   | 1 |   2 | 3 | 4 | 5 |   6 | 7 | 8   |
    |---+-----+---+-----+---+---+---+-----+---+-----|
    | 0 | 0,0 |   |     |   |   |   |     |   | 8,0 |
    | 1 |     |   |     |   |   |   |     |   |     |
    | 2 |     |   |     |   |   |   | 6,2 |   | 8,2 |
    | 3 |     |   |     |   |   |   |     |   |     |
    | 4 |     |   |     |   |   |   |     |   |     |
    | 5 |     |   |     |   |   |   |     |   |     |
    | 6 |     |   | 2,6 |   |   |   |     |   |     |
    | 7 |     |   |     |   |   |   |     |   |     |
    | 8 | 0,8 |   |     |   |   |   |     |   | 8,8 |

*** 棋譜のパース

    - "7六歩" の場合 "7六" と "歩" に分離する。
    - "2二角成" の場合 "2二" と "角" と "成" に分離する。
    - 同銀の場合、同がどこを差しているのか、前の座標を見る。
    - "5八金右" の場合、5八から見て右下にある金が斜め上に上がったという意味なのでこの解釈が難しい。
    - "4八" に金があった場合、"5八金右" は真横の金なのか、斜め下の金なのか、どっちだろう。
    - ネット上にある棋譜はだいたい "7六歩(77)" の形式になっていて７七にあったことを明示しているのでがんばって推測しなくてもいい。

*** KIFフォーマット

    : # ----  Kifu for Windows V6.22 棋譜ファイル  ----
    : 開始日時：2000/01/01 00:00:00
    : 終了日時：2000/01/01 01:00:00
    : 棋戦：(棋戦)
    : 持ち時間：(持ち時間)
    : 手合割：平手　　
    : 先手：(先手)
    : 後手：(後手)
    : 手数----指手---------消費時間--
    : *対局前コメント
    :    1 ７六歩(77)   ( 0:10/00:00:10)
    : *コメント1
    :    2 ３四歩(33)   ( 0:10/00:00:20)
    :    3 ６六歩(67)   ( 0:10/00:00:30)
    :    4 ８四歩(83)   ( 0:10/00:00:40)
    : *コメント2
    :    5 投了         ( 0:10/00:00:50)
    : まで4手で後手の勝ち

    - ヘッダーとコンテンツを分けるセパレーターは */^手数.*/*
    - コメントは *直前の指し手* に結び付いている
    - 最初のコメントは *結び付く指し手がない*
    - 「投了」は取り込んだ方がいいのかよくわからない
    - アスタリスクで始まるコメント部分には何を書いてもいいというのを利用して一手目の上に開始前メッセージがあるのがおかしい。結び付く手がない。開始前メッセージはヘッダーに入っていればよかった。
    - 手合割の値の最後に謎の全角スペース2つ。なんじゃこれ

*** KI2フォーマット

    : 開始日時：2000/01/01 00:00
    : 終了日時：2000/01/01 01:00
    : 表題：(表題)
    : 棋戦：(棋戦)
    : 戦型：(戦型)
    : 持ち時間：(持ち時間)
    : 場所：(場所)
    : 掲載：(掲載)
    : 立会人：(立会人)
    : 副立会人：(副立会人)
    : 記録係：(記録係)
    : Web Page：(Web Page)
    : 通算成績：(通算成績)
    : 先手：(先手)
    : 後手：(後手)
    :
    : *対局前コメント
    : ▲７六歩    △３四歩
    : *コメント1
    : ▲６六歩△８四歩
    : *コメント2
    : まで4手で後手の勝ち

    - ヘッダーとコンテンツを分けるセパレーターは *最初の空行*
    - 指し手は横に何個並んでもいいっぽい
    - 指し手のセパレータは *空白ではない* 。くっついている場合もあるので、▲または△、の前で区切る。
    - *投了* がない
    - "#" もない(？)

*** 英語表記対応表

    | 日本語   | 英語     |
    |----------+----------|
    | 歩       | pawn     |
    | 角       | bishop   |
    | 飛       | rook     |
    | 香       | lance    |
    | 桂       | knight   |
    | 銀       | silver   |
    | 金       | gold     |
    | 玉       | king     |
    | 成った   | promoted |
    | 盤面     | board    |
    | 座標     | point    |
    | 相対座標 | vector   |
    | 先手     | black    |
    | 後手     | white    |
    | 対局室   | frame    |

** BUG

** _TODO_

   - DSLに rem(仮) 追加
   - コードが雑になるので blank? を使うのを禁止する
   - 「香落ち」対応。香落ちなどは先手と決まっている
   - どうぶつ将棋の例
   - ブラウザ 駒のドラッグ
   - FrameDecorator で移動元・移動先のクラス指定
   - 「詰み」の状態を判断する
   - 形勢判断クラスをStrategyやadapterみたいにする
   - ▽1八杏成 ではなく 香成
   - 例外クラスは引数を受け取って自分でメッセージを作成する
   - 棋譜のXML
   - ki2 kif 相互変換
   - 思考ルーチン
   - WEBで棋譜
   - 陣形名表示
   - 戦術表示
   - USI
   - Windowsブリッジ
   - GUI表示
   - cli
   - +5x5将棋配置+
   - +BUG:"1一と成(12)" +
   - +「２三銀直不成」対応+
   - +２二銀引成、できる？+
   - +▲24歩 をよむ+
   - +kif→ki2で"同"金+
   - +持駒は「歩歩」は「歩二」+
   - +不成の明示指定+

** 参考リンク集

   - 棋譜の形式について http://wiki.optus.nu/shogi/index.php?post=%B4%FD%C9%E8%A4%CE%B7%C1%BC%B0%A4%CB%A4%C4%A4%A4%A4%C6
   - 二歩 - Wikipedia http://ja.wikipedia.org/wiki/%E4%BA%8C%E6%AD%A9#cite_note-4
   - CC Resources for Shogi Applications | 将棋アプリ用クリエイティブコモンズ画像 http://mucho.girly.jp/bona/
   - 将棋所：USIプロトコルとは http://www.geocities.jp/shogidokoro/usi.html
